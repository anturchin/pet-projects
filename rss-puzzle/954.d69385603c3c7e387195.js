"use strict";(self.webpackChunkRSS_Puzzle=self.webpackChunkRSS_Puzzle||[]).push([[954],{38:(e,t,n)=>{n.r(t),n.d(t,{Game:()=>Q});var l=n(766);class o extends l.S{constructor(){super({tag:"div",classNames:["game__puzzle","placeholder"],callback:null})}}class s extends l.S{constructor(e){super({tag:"ul",callback:null,classNames:["game__row","active"]}),this.onCellsChecked=e,this.onDragOverGame=this.onDragOverGame.bind(this),this.onDropGame=this.onDropGame.bind(this),this.setEventListener()}removeEventListener(){this.viewHtmlElementCreator.getElement().removeEventListener("dragover",this.onDragOverGame),this.viewHtmlElementCreator.getElement().removeEventListener("drop",this.onDropGame),this.viewHtmlElementCreator.getElement().classList.remove("active")}setEventListener(){this.viewHtmlElementCreator.getElement().addEventListener("dragover",this.onDragOverGame),this.viewHtmlElementCreator.getElement().addEventListener("drop",this.onDropGame)}onDragOverGame(e){e.preventDefault()}onDropGame(e){var t,n;e.preventDefault();const l=null===(t=e.dataTransfer)||void 0===t?void 0:t.getData("id"),o=document.getElementById(`${l}`),s=e.target;if(s&&o){o.setAttribute("data-is-result-block","true");const e=this.viewHtmlElementCreator.getElement(),t=Array.from(e.children).indexOf(s),l=Array.from(e.children).indexOf(o);e===(null==o?void 0:o.parentNode)&&e===(null==s?void 0:s.parentNode)?(o&&s&&(e.contains(o)&&e.removeChild(o),e.contains(s)&&e.removeChild(s)),l<t?(e.insertBefore(s,e.children[l]),e.insertBefore(o,e.children[t])):(e.insertBefore(o,e.children[t]),e.insertBefore(s,e.children[l]))):e.appendChild(o),null===(n=this.onCellsChecked)||void 0===n||n.call(this)}}}class i extends l.S{constructor(){super({tag:"div",callback:null,classNames:["game__source"]})}}class r extends l.S{constructor(e){super({tag:"ul",callback:null,classNames:["source__row"]}),this.onCellsChecked=e,this.onDragOverGame=this.onDragOverGame.bind(this),this.onDropGame=this.onDropGame.bind(this),this.setEventListener()}setEventListener(){this.viewHtmlElementCreator.getElement().addEventListener("dragover",this.onDragOverGame),this.viewHtmlElementCreator.getElement().addEventListener("drop",this.onDropGame)}onDragOverGame(e){e.preventDefault()}onDropGame(e){var t,n;e.preventDefault();const l=null===(t=e.dataTransfer)||void 0===t?void 0:t.getData("id"),o=document.getElementById(`${l}`),s=e.target;if(s&&o){o.setAttribute("data-is-result-block","false");const e=this.viewHtmlElementCreator.getElement(),t=Array.from(e.children).indexOf(s),l=Array.from(e.children).indexOf(o);e===(null==o?void 0:o.parentNode)&&e===(null==s?void 0:s.parentNode)?(o&&s&&(e.contains(o)&&e.removeChild(o),e.contains(s)&&e.removeChild(s)),l<t?(e.insertBefore(s,e.children[l]),e.insertBefore(o,e.children[t])):(e.insertBefore(o,e.children[t]),e.insertBefore(s,e.children[l]))):e.appendChild(o),null===(n=this.onCellsChecked)||void 0===n||n.call(this)}}}class a{static shuffle(e){const t=[...e];for(let e=t.length-1;e>0;e-=1){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}}class d{static sum(e){return[...e.split(" ")].reduce(((e,t)=>e+t.length),0)}}class u extends l.S{constructor(e,t,n,l){super({tag:"li",callback:null,classNames:["game__cell","word-animation"]}),this.onCellsChecked=l,this.onCellClick=this.onCellClick.bind(this),this.onDragStartCell=this.onDragStartCell.bind(this),this.onDragEndCell=this.onDragEndCell.bind(this),this.setupGameCell(e,t,n),this.setupEventListener()}removeAttributes(){const e=this.viewHtmlElementCreator.getElement();e.id="",e.draggable=!1,e.removeAttribute("data-width"),e.removeAttribute("data-word"),e.removeAttribute("data-word-origin"),e.removeAttribute("data-word-origin-id"),e.removeAttribute("data-is-result-block")}removeEventListener(){this.removeAttributes(),this.viewHtmlElementCreator.getElement().removeEventListener("click",this.onCellClick),this.viewHtmlElementCreator.getElement().removeEventListener("dragstart",this.onDragStartCell),this.viewHtmlElementCreator.getElement().removeEventListener("dragend",this.onDragEndCell)}setupEventListener(){this.viewHtmlElementCreator.getElement().addEventListener("click",this.onCellClick),this.viewHtmlElementCreator.getElement().addEventListener("dragstart",this.onDragStartCell),this.viewHtmlElementCreator.getElement().addEventListener("dragend",this.onDragEndCell)}onCellClick(e){var t;const n=e.target,l=n.classList.contains("invalid"),o=n.classList.contains("valid");if(l||o)return;const s=document.querySelector(".source__row"),i=document.querySelector(".game__row.active");s&&i&&(s.contains(n)?(n.setAttribute("data-is-result-block","true"),i.appendChild(n)):i.contains(n)&&(n.setAttribute("data-is-result-block","false"),s.appendChild(n)),null===(t=this.onCellsChecked)||void 0===t||t.call(this))}onDragStartCell(e){var t;const n=this.viewHtmlElementCreator.getElement(),l=n.classList.contains("invalid"),o=n.classList.contains("valid");l||o?e.preventDefault():(null===(t=e.dataTransfer)||void 0===t||t.setData("id",this.viewHtmlElementCreator.getElement().id),n.classList.add("over"))}onDragEndCell(e){const t=this.viewHtmlElementCreator.getElement(),n=t.classList.contains("invalid"),l=t.classList.contains("valid");n||l?e.preventDefault():t.classList.remove("over")}setupGameCell(e,t,n){const l=document.querySelector(".source__row");if(l){const o=l.offsetWidth,s=d.sum(n),i=this.viewHtmlElementCreator.getElement();i.id=`${t+1}`,i.draggable=!0;const r=e.length/s*o;i.style.width=`${r}px`,i.setAttribute("data-width",`${r}`),i.setAttribute("data-is-result-block","false"),i.innerHTML=`<span>${e}</span>`}}}class c extends l.S{constructor(){super({tag:"div",callback:null,classNames:["toolbar-bottom"]})}}var h=n(440);class m{constructor(e){this.gameData=null,this.currentRoundIndex=0,this.currentSentenceIndex=0,this.subject=e,this.setupGameState()}updateRound(e){this.gameData&&e<=this.gameData.length&&(this.currentRoundIndex=e,this.currentSentenceIndex=0,this.saveStateToLocalStorage())}restartGame(){this.currentRoundIndex=0,this.currentSentenceIndex=0,this.saveStateToLocalStorage()}moveToNextRound(){this.gameData&&this.currentRoundIndex<this.gameData.length-1?(this.currentRoundIndex+=1,this.currentSentenceIndex=0):this.restartGame(),this.saveStateToLocalStorage(),this.subject.notifyObservers(this.currentRoundIndex)}moveToNextWord(){const e=this.getCurrentRound();e&&this.currentSentenceIndex<e.words.length-1?this.currentSentenceIndex+=1:this.moveToNextRound(),this.saveStateToLocalStorage()}getGameData(){return this.gameData}setGameData(e){this.gameData=e}setCurrentRoundIndex(e){this.currentRoundIndex=e,this.saveStateToLocalStorage()}setCurrentSentenceIndex(e){this.currentSentenceIndex=e,this.saveStateToLocalStorage()}getCurrentRound(){return this.gameData?this.gameData[this.currentRoundIndex]:null}getCurrentWords(){return this.gameData?this.gameData[this.currentRoundIndex].words:null}getCurrentSentenceIndex(){return this.currentSentenceIndex}getCurrentSentence(){const e=this.getCurrentRound();return e?e.words[this.currentSentenceIndex].textExample:null}getCurrentImagePath(){const e=this.getCurrentRound();return e?e.levelData.imageSrc:null}setupGameState(){const e=h.q.getGameIndexes();e&&(this.currentRoundIndex=e.currentRoundIndex)}saveStateToLocalStorage(){h.q.saveGameIndexes({currentRoundIndex:this.currentRoundIndex})}}const v="https://raw.githubusercontent.com/anturchin/rss-puzzle-data/main",g={LEVEL_1:"/data/wordCollectionLevel1.json",LEVEL_2:"/data/wordCollectionLevel2.json",LEVEL_3:"/data/wordCollectionLevel3.json",LEVEL_4:"/data/wordCollectionLevel4.json",LEVEL_5:"/data/wordCollectionLevel5.json",LEVEL_6:"/data/wordCollectionLevel6.json"};class C{constructor(){this.audio=new Audio}playSound(e){this.audio.src=e,this.audio.play()}}class p{constructor(e,t){this.game=e,this.player=new C,this.mainController=t,this.setupEventListener()}playSound(){var e;const t=this.mainController.getCurrentWordInfo();if(t){const n=`${v}/${t.audioExample}`;this.player.playSound(n);const l=null===(e=this.game.buttonAudioHint)||void 0===e?void 0:e.getElement();l&&l.classList.add("sound-animation")}}stopAnimation(){var e;const t=null===(e=this.game.buttonAudioHint)||void 0===e?void 0:e.getElement();t&&t.classList.remove("sound-animation")}setupEventListener(){this.player.audio.addEventListener("ended",this.stopAnimation.bind(this))}}class E{static parseGameData({rounds:e}){return e.map((e=>({levelData:e.levelData,words:e.words.map((e=>({audioExample:e.audioExample,textExample:e.textExample,textExampleTranslate:e.textExampleTranslate,id:e.id,word:e.word,wordTranslate:e.wordTranslate})))})))}}class L{static loadJSON(e){return t=this,n=void 0,o=function*(){try{const t=yield fetch(e);if(!t.ok)throw new Error("failed to load date");return yield t.json()}catch(e){throw e instanceof Error&&console.error(`error loading JSON: ${e.message}`),new Error("failed to load date")}},new((l=void 0)||(l=Promise))((function(e,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function r(e){try{a(o.throw(e))}catch(e){s(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof l?n:new l((function(e){e(n)}))).then(i,r)}a((o=o.apply(t,n||[])).next())}));var t,n,l,o}}class k{constructor(e){this.state=e,this.level=1}setRound(e){this.state.updateRound(e)}getCurrentRound(){return this.state.getCurrentRound()||null}moveToNextWord(){this.state.moveToNextWord()}getCurrentImagePath(){return`${v}/images/${this.state.getCurrentImagePath()}`}getCurrentWords(){return this.state.getCurrentWords()}getTextExample(){return this.state.getCurrentSentence()}getCurrentWordIndex(){return this.state.getCurrentSentenceIndex()}setLevel(e){this.level=e,this.state.setCurrentRoundIndex(0)}loadGameData(){return e=this,t=void 0,l=function*(){try{if(v){const e=this.getLevelPath(this.level),t=yield L.loadJSON(`${v}${e}`),n=E.parseGameData(t);this.state.setGameData(n)}}catch(e){e instanceof Error&&console.error(e.message)}},new((n=void 0)||(n=Promise))((function(o,s){function i(e){try{a(l.next(e))}catch(e){s(e)}}function r(e){try{a(l.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}a((l=l.apply(e,t||[])).next())}));var e,t,n,l}getLevelPath(e){switch(e){case 1:return g.LEVEL_1;case 2:return g.LEVEL_2;case 3:return g.LEVEL_3;case 4:return g.LEVEL_4;case 5:return g.LEVEL_5;case 6:return g.LEVEL_6;default:throw new Error("Invalid level")}}}class w{constructor(e,t,n,l,o){this.game=e,this.mainController=n,this.logicController=t,this.hideController=l,this.audioController=o,this.handleClickCell(),this.handleClickButtonCheck(),this.onHandleClickAutoComplete(),this.onHandleClickContinue(),this.onHandleClickAudioSound()}setupLevelAndRoundHandler(){var e;const t=null===(e=this.game.toolBarTopMain)||void 0===e?void 0:e.levelAndRoundBlock;if(t){const{level:e,round:n}=t;e&&n&&(e.setLevelChangeHandler((e=>{this.mainController.setLevel(e)})),n.setRoundChangeHandler((e=>{this.mainController.setRound(e)})))}}handleClickCell(){this.game.onCellsChecked=()=>{this.logicController.isAllCellsAreResultBlock()?(this.hideController.activeButtonCheck(),this.logicController.checkWordValidity()):(this.hideController.disabledButtonCheck(),this.hideController.disabledButtonContinue(),this.hideController.hideButtonContinue(),this.hideController.showButtonCheck())}}removeHandleClickAndDragAndDrop(){this.game.resultLine&&this.game.resultLine.removeEventListener(),this.game.cells&&this.game.cells.forEach((e=>{e.removeEventListener()}))}handleClickButtonCheck(){this.game.onHandleClickCheck=()=>{var e;if(!this.logicController.isAllCellsAreResultBlock())return void this.hideController.disabledButtonCheck();const t=(null===(e=this.game.buttonContinue)||void 0===e?void 0:e.getElement()).disabled;this.hideController.disabledButtonCheck(),this.hideController.disabledButtonContinue(),this.hideController.disabledButtonAutoComplete(),this.logicController.checkCellValidity(),setTimeout((()=>{this.logicController.checkCellValidity(),this.hideController.activeButtonCheck(),this.hideController.activeButtonAutoComplete(),t||this.hideController.activeButtonContinue()}),3e3)}}onHandleClickContinue(){this.game.onHandleClickContinue=()=>{this.logicController.isNewRoundStarted()?this.mainController.endGame():this.mainController.continueGame()}}onHandleClickAutoComplete(){this.game.onHandleClickAutoComplete=()=>{this.logicController.autofillSentenceInResultLine()}}onHandleClickAudioSound(){this.game.onHandleClickAudioSound=()=>{this.audioController.playSound()}}}class x{constructor(e){this.game=e}disabledButtonContinue(){var e;(null===(e=this.game.buttonContinue)||void 0===e?void 0:e.getElement()).disabled=!0}activeButtonContinue(){var e;(null===(e=this.game.buttonContinue)||void 0===e?void 0:e.getElement()).disabled=!1}disabledButtonAutoComplete(){var e;(null===(e=this.game.buttonAutoComplete)||void 0===e?void 0:e.getElement()).disabled=!0}activeButtonAutoComplete(){var e;(null===(e=this.game.buttonAutoComplete)||void 0===e?void 0:e.getElement()).disabled=!1}disabledButtonCheck(){var e,t;(null===(e=this.game.buttonCheck)||void 0===e?void 0:e.getElement()).classList.remove("button-animation"),(null===(t=this.game.buttonCheck)||void 0===t?void 0:t.getElement()).disabled=!0}activeButtonCheck(){var e,t;(null===(e=this.game.buttonCheck)||void 0===e?void 0:e.getElement()).classList.add("button-animation"),(null===(t=this.game.buttonCheck)||void 0===t?void 0:t.getElement()).disabled=!1}hideButtonCheck(){const e=this.game.buttonCheck;e&&this.hideButton(e)}hideButtonContinue(){const e=this.game.buttonContinue;e&&this.hideButton(e)}showButtonCheck(){const e=this.game.buttonCheck;e&&this.showButton(e)}showButtonContinue(){const e=this.game.buttonContinue;e&&this.showButton(e)}hideButton(e){const t=e.getElement();t&&(t.classList.remove("show"),t.classList.add("hide"))}showButton(e){const t=e.getElement();t&&(t.classList.add("show"),t.classList.remove("hide"))}hideHintBlock(){const e=document.querySelector(".hint");e&&(e.style.display="none")}showHintBlock(){const e=document.querySelector(".hint");e&&(e.style.display="flex")}}class b{constructor(e,t){this.dataController=e,this.renderController=t}setCompletedRoundImagePath(){var e;const t=null===(e=this.dataController.getCurrentRound())||void 0===e?void 0:e.levelData;t&&this.renderController.renderImageInGamePuzzleContainer(t.author,`${v}/images/${t.imageSrc}`,t.name,t.year)}}class f{constructor(e,t,n,l){this.game=e,this.mainController=n,this.dataController=t,this.hideController=l}autofillSentenceInResultLine(){var e;const t=null===(e=this.dataController.getTextExample())||void 0===e?void 0:e.split(" ");if(t){const{cells:e}=this.game,n=e.map((e=>e.getElement())),l=[],o=n.slice();t.forEach((e=>{const t=[];o.forEach((e=>t.push(e.textContent||"")));const n=t.indexOf(e);-1!==n&&(l.push(o[n]||""),o.splice(n,1))})),this.mainController.getRenderController().renderAutoFillSentenceInResultLine(l),this.hideController.disabledButtonCheck(),this.hideController.hideButtonCheck(),this.hideController.activeButtonContinue(),this.hideController.showButtonContinue()}}checkWordValidity(){var e;const t=null===(e=this.dataController.getTextExample())||void 0===e?void 0:e.split(" "),n=this.getAllCellsFromResultLine();if(n){const e=[...n].reduce(((e,t)=>(t.textContent&&e.push(t.textContent),e)),[]);t&&e&&((null==t?void 0:t.every(((t,n)=>t===e[n])))?(this.hideController.activeButtonContinue(),this.hideController.showButtonContinue(),this.hideController.hideButtonCheck(),this.mainController.nextSentence()):(this.hideController.disabledButtonContinue(),this.hideController.hideButtonContinue(),this.hideController.showButtonCheck()))}}getResultsLine(){return!!this.game.gamePuzzleBlock&&this.game.gamePuzzleBlock.getElement().querySelectorAll("ul")}isAllCellsAreResultBlock(){var e;return null===(e=this.game.cells)||void 0===e?void 0:e.every((e=>"true"===e.getElement().getAttribute("data-is-result-block")))}getAllCellsFromResultLine(){var e;return(null===(e=this.game.resultLine)||void 0===e?void 0:e.getElement().children)||null}checkCellValidity(){var e;const t=this.getAllCellsFromResultLine(),n=null===(e=this.dataController.getTextExample())||void 0===e?void 0:e.split(" ");t&&n&&[...t].forEach(((e,t)=>{n[t]===e.textContent?e.classList.toggle("valid"):e.classList.toggle("invalid")}))}isNewRoundStarted(){const e=this.getResultsLine(),t=this.dataController.getCurrentWords();return!(!e||!t)&&e.length===t.length}removeAllResultLines(){this.game.gamePuzzleBlock&&this.game.gamePuzzleBlock.getElement().querySelectorAll("ul").forEach((e=>e.remove()))}}class H extends l.S{constructor(e){super({tag:"img",classNames:["images"],callback:null}),this.setupGamePuzzleImage(e)}setupGamePuzzleImage(e){const t=this.viewHtmlElementCreator.getElement();t.setAttribute("src",e),t.setAttribute("alt","image puzzle"),t.draggable=!1}}class B{constructor(e,t,n){this.game=e,this.eventController=t,this.dataController=n}updateResultLineAndSourceLine(){var e;this.eventController.removeHandleClickAndDragAndDrop();const t=null===(e=this.game.gamePuzzleBlock)||void 0===e?void 0:e.getElement();if(t){t.classList.add("placeholder");const e=t.querySelector(".images");null==e||e.remove()}this.game.renderGamePuzzleLine(),this.game.renderGameCells()}renderImageInGamePuzzleContainer(e,t,n,l){var o,s,i;const r=new H(t).getElement();null===(o=this.game.gamePuzzleBlock)||void 0===o||o.getElement().classList.remove("placeholder"),null===(s=this.game.gamePuzzleBlock)||void 0===s||s.addInnerElement(r);const a=null===(i=this.game.gameSourceLine)||void 0===i?void 0:i.getElement();a&&(a.innerHTML=`<h4>${e} - ${n} (${l})</h4>`)}renderAutoFillSentenceInResultLine(e){const t=document.querySelector(".game__row.active");t&&e.forEach((e=>{e.setAttribute("data-is-result-block","true"),t.append(e)}))}updateHintText(){var e;const t=null===(e=this.game.hintText)||void 0===e?void 0:e.getElement(),n=this.dataController.getCurrentRound(),l=this.dataController.getCurrentWordIndex();t&&n&&(t.textContent=n.words[l].textExampleTranslate)}clearHintText(){var e;const t=null===(e=this.game.hintText)||void 0===e?void 0:e.getElement();t&&(t.textContent="")}}class S{constructor(e,t,n){this.game=e,this.router=t,this.subject=n,this.state=new m(this.subject),this.audioController=new p(this.game,this),this.hideController=new x(this.game),this.dataController=new k(this.state),this.logicController=new f(this.game,this.dataController,this,this.hideController),this.eventController=new w(this.game,this.logicController,this,this.hideController,this.audioController),this.renderController=new B(this.game,this.eventController,this.dataController),this.imageController=new b(this.dataController,this.renderController)}getCurrentWordInfo(){var e;const t=this.getCurrentWordIndex();return(null===(e=this.dataController.getCurrentWords())||void 0===e?void 0:e[t])||null}getGameData(){return this.state.getGameData()||null}getRenderController(){return this.renderController}setLevel(e){if(this.game.toolBarTopMain&&this.game.toolBarTopMain.levelAndRoundBlock){const{round:e}=this.game.toolBarTopMain.levelAndRoundBlock;e&&e.setCurrentRound(0)}this.dataController.setLevel(e),this.game.loadData()}setRound(e){this.dataController.setRound(e),this.game.loadData()}getCurrentWordIndex(){return this.dataController.getCurrentWordIndex()}loadGameData(){return e=this,t=void 0,l=function*(){yield this.dataController.loadGameData()},new((n=void 0)||(n=Promise))((function(o,s){function i(e){try{a(l.next(e))}catch(e){s(e)}}function r(e){try{a(l.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}a((l=l.apply(e,t||[])).next())}));var e,t,n,l}getTextExample(){return this.dataController.getTextExample()}getImagePath(){var e;return null===(e=this.dataController)||void 0===e?void 0:e.getCurrentImagePath()}endGame(){this.logicController.removeAllResultLines(),this.imageController.setCompletedRoundImagePath(),this.renderController.clearHintText(),this.hideController.hideButtonCheck(),this.hideController.hideHintBlock()}continueGame(){this.dataController.moveToNextWord(),this.hideController.disabledButtonContinue(),this.renderController.updateResultLineAndSourceLine(),this.renderController.updateHintText(),this.hideController.hideButtonContinue(),this.hideController.showButtonCheck(),this.hideController.disabledButtonCheck(),this.hideController.showHintBlock()}nextSentence(){this.eventController.onHandleClickContinue()}}class _{static createImages(e,t,n,l,o){var s;const i=document.querySelectorAll(`${t}`),r=document.querySelector(`.${n}`),a=null==r?void 0:r.offsetWidth,d=null==r?void 0:r.offsetHeight,u=null===(s=o.getTextExample())||void 0===s?void 0:s.split(" "),c=[...i].map((e=>e)),h=[],m=c.slice();u&&u.forEach((e=>{const t=[];m.forEach((e=>t.push(e.textContent||"")));const n=t.indexOf(e);-1!==n&&(h.push(m[n]||""),m.splice(n,1))}));let v=0;h.forEach((t=>{const n=new Image;n.src=l,n.alt="puzzle piece",n.draggable=!1,n.classList.add("puzzle-image");const o=e*t.offsetHeight;n.style.width=`${a}px`,n.style.height=`${d}px`,n.style.position="absolute",n.style.top=`${o}px`,n.style.left=`-${v}px`,t.append(n),v+=t.offsetWidth}))}}class A extends l.S{constructor(e){super({tag:"button",callback:null,classNames:["toolbar-bottom__btn-continue","button-animation"],textContent:"Continue"}),this.onHandleClickContinue=e,this.setupButtonContinue(),this.setupEventListener()}setupEventListener(){this.viewHtmlElementCreator.getElement().addEventListener("click",(()=>{var e;null===(e=this.onHandleClickContinue)||void 0===e||e.call(this)}))}setupButtonContinue(){const e=this.viewHtmlElementCreator.getElement();e.classList.add("hide"),e.disabled=!0,e.draggable=!1}}class R extends l.S{constructor(e){super({tag:"button",callback:null,classNames:["toolbar-bottom__btn-check"],textContent:"Check"}),this.onHandleClickCheck=e,this.setupButtonContinue(),this.setupEventListener()}setupEventListener(){this.viewHtmlElementCreator.getElement().addEventListener("click",(()=>{var e;null===(e=this.onHandleClickCheck)||void 0===e||e.call(this)}))}setupButtonContinue(){const e=this.viewHtmlElementCreator.getElement();e.disabled=!0,e.draggable=!1}}class I extends l.S{constructor(e){super({tag:"button",callback:null,classNames:["toolbar-bottom__btn-auto","button-animation"],textContent:"I don't know"}),this.onHandleClickAutoComplete=e,this.setupButtonContinue(),this.setupEventListener()}setupEventListener(){this.viewHtmlElementCreator.getElement().addEventListener("click",(()=>{var e;null===(e=this.onHandleClickAutoComplete)||void 0===e||e.call(this)}))}setupButtonContinue(){}}class T extends l.S{constructor(){super({tag:"div",callback:null,classNames:["game-hint"]})}}const D=n.p+"images/sound..png";class y extends l.S{constructor(){super({tag:"img",callback:null,classNames:["game-hint__img"]}),this.setupPronunciationHintIcon()}setupPronunciationHintIcon(){const e=this.viewHtmlElementCreator.getElement();e&&e.setAttribute("src",`${D}`)}}class z extends l.S{constructor(e){super({tag:"div",callback:null,classNames:["game-hint__button","show__text"]}),this.onHandleClickAudioSound=e,this.setupPronunciationHintButton(),this.setEventListener()}setEventListener(){this.viewHtmlElementCreator.getElement().addEventListener("click",(()=>{var e;null===(e=this.onHandleClickAudioSound)||void 0===e||e.call(this)}))}setupPronunciationHintButton(){const e=(new y).getElement();this.viewHtmlElementCreator.addInnerElement(e)}}class G extends l.S{constructor(){super({tag:"p",callback:null,classNames:["game-hint__text","text-animation","show__text"]})}}class P extends l.S{constructor(e,t){super({tag:"select",callback:null,classNames:["level__select"]}),this.levelValue=t,this.count=e,this.setupLevelSwitch()}getCurrentLevel(){return this.levelValue}setLevelChangeHandler(e){this.viewHtmlElementCreator.getElement().addEventListener("change",(t=>{const n=t.target.value;this.levelValue=parseInt(n,10),e(parseInt(n,10))}))}setupLevelSwitch(){const e=[];for(let t=0;t<this.count;t+=1){const n=document.createElement("option");n.value=`${t+1}`,n.textContent=`level-${t+1}`,t+1===this.levelValue&&(n.selected=!0),e.push(n)}this.viewHtmlElementCreator.getElement().append(...e)}}class N extends l.S{constructor(e,t,n){super({tag:"select",callback:null,classNames:["round__select"]}),this.count=e;const l=h.q.getGameIndexes();if(null!==l){const{currentRoundIndex:e}=l;this.savedRound=e}else this.savedRound=t;this.subject=n,this.setupRoundSwitch()}update(e){this.savedRound=e,[...this.viewHtmlElementCreator.getElement().children].forEach((e=>{parseInt(e.getAttribute("value")||"",10)===this.savedRound&&e.setAttribute("selected","true")}))}getCurrentRound(){return this.savedRound}setCurrentRound(e){this.savedRound=e}setRoundChangeHandler(e){this.viewHtmlElementCreator.getElement().addEventListener("change",(t=>{const n=t.target.value;this.savedRound=parseInt(n,10),e(parseInt(n,10))}))}setupRoundSwitch(){const e=[];for(let t=0;t<this.count;t+=1){const n=document.createElement("option");n.value=`${t}`,n.textContent=`round-${t+1}`,t===this.savedRound&&(n.selected=!0),e.push(n)}this.viewHtmlElementCreator.getElement().append(...e),this.subject.addObserver(this)}}class $ extends l.S{constructor(e,t,n,l,o){super({tag:"div",callback:null,classNames:["level-and-round"]}),this.level=null,this.round=null,this.setupLevelAndRoundBlock(e,t,n,l,o)}setupLevelAndRoundBlock(e,t,n,l,o){this.level=new P(e,n),this.round=new N(t,l,o),this.viewHtmlElementCreator.getElement().append(this.level.getElement(),this.round.getElement())}}const M=n.p+"images/image-hint..svg";class O extends l.S{constructor(){super({tag:"div",callback:null,classNames:["hint__image"]}),this.setupButtonHintImage()}setupButtonHintImage(){const e=document.createElement("img");e.src=M,e.classList.add("icon"),this.viewHtmlElementCreator.addInnerElement(e)}}const W=n.p+"images/audio-hint..svg";class q extends l.S{constructor(){super({tag:"div",callback:null,classNames:["hint__sound"]}),this.onHintClick=this.onHintClick.bind(this),this.setupEventListener(),this.setupButtonHintSound()}setupEventListener(){this.viewHtmlElementCreator.getElement().addEventListener("click",this.onHintClick)}toggleClass(e){e.classList.contains("show__text")?(e.classList.remove("show__text"),e.classList.add("hide__text")):(e.classList.add("show__text"),e.classList.remove("hide__text"))}onHintClick(){const e=document.querySelector(".game-hint__button");e&&this.toggleClass(e)}setupButtonHintSound(){const e=document.createElement("img");e.src=W,e.classList.add("icon"),this.viewHtmlElementCreator.addInnerElement(e)}}const V=n.p+"images/text-hint..svg";class j extends l.S{constructor(){super({tag:"div",callback:null,classNames:["hint__text"]}),this.onHintClick=this.onHintClick.bind(this),this.setupEventListener(),this.setupButtonHintText()}setupEventListener(){this.viewHtmlElementCreator.getElement().addEventListener("click",this.onHintClick)}toggleClass(e){e.classList.contains("show__text")?(e.classList.remove("show__text"),e.classList.add("hide__text")):(e.classList.add("show__text"),e.classList.remove("hide__text"))}onHintClick(){const e=document.querySelector(".game-hint__text");e&&this.toggleClass(e)}setupButtonHintText(){const e=document.createElement("img");e.src=V,e.classList.add("icon"),this.viewHtmlElementCreator.addInnerElement(e)}}class F extends l.S{constructor(){super({tag:"div",callback:null,classNames:["hint"]}),this.setupHintBlock()}setupHintBlock(){const e=(new j).getElement(),t=(new q).getElement(),n=(new O).getElement();this.viewHtmlElementCreator.getElement().append(t,e,n)}}class J extends l.S{constructor(e,t,n,l,o){super({tag:"div",callback:null,classNames:["tool-bar__top"]}),this.levelAndRoundBlock=null,this.setupTollBarTopMain(e,t,n,l,o)}setupTollBarTopMain(e,t,n,l,o){this.levelAndRoundBlock=new $(e,t,n,l,o);const s=(new F).getElement();this.viewHtmlElementCreator.getElement().append(this.levelAndRoundBlock.getElement(),s)}}class K{constructor(){this.observers=[]}addObserver(e){this.observers.push(e)}notifyObservers(e){this.observers.forEach((t=>{t.update(e)}))}}class Q extends l.S{constructor(e){super({tag:"section",callback:null,classNames:["game__wrapper"]}),this.savedLevel=1,this.savedRound=0,this.cells=[],this.resultLine=null,this.gamePuzzleBlock=null,this.gameSourceLine=null,this.buttonContinue=null,this.buttonCheck=null,this.buttonAutoComplete=null,this.buttonAudioHint=null,this.hintText=null,this.toolBarTopMain=null,this.subject=new K,this.controller=new S(this,e,this.subject),this.loadData()}loadData(){return e=this,t=void 0,l=function*(){try{yield this.controller.loadGameData(),this.clearDOMAndSaveSelectedLevel(),this.render()}catch(e){e instanceof Error&&console.error(e.message)}},new((n=void 0)||(n=Promise))((function(o,s){function i(e){try{a(l.next(e))}catch(e){s(e)}}function r(e){try{a(l.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,r)}a((l=l.apply(e,t||[])).next())}));var e,t,n,l}clearDOMAndSaveSelectedLevel(){const e=this.viewHtmlElementCreator.getElement();if(this.toolBarTopMain&&this.toolBarTopMain.levelAndRoundBlock){const{level:e}=this.toolBarTopMain.levelAndRoundBlock;e&&(this.savedLevel=e.getCurrentLevel())}if(this.toolBarTopMain&&this.toolBarTopMain.levelAndRoundBlock){const{round:e}=this.toolBarTopMain.levelAndRoundBlock;e&&(this.savedRound=e.getCurrentRound())}e.innerHTML="",this.cells=[],this.resultLine=null,this.gamePuzzleBlock=null,this.gameSourceLine=null,this.buttonContinue=null,this.buttonCheck=null,this.buttonAutoComplete=null,this.buttonAudioHint=null,this.hintText=null,this.toolBarTopMain=null}render(){this.renderPronunciationHint(),this.renderGamePuzzle(),this.renderGamePuzzleLine(),this.renderGameSource(),this.renderGameSourceLine(),this.renderGameCells(),this.renderToolBarBottom(),this.renderToolBarTopMain()}renderGamePuzzle(){this.gamePuzzleBlock=null,this.gamePuzzleBlock=new o,this.gamePuzzleBlock&&this.viewHtmlElementCreator.addInnerElement(this.gamePuzzleBlock.getElement())}renderGamePuzzleLine(){this.resultLine=null,this.resultLine=new s((()=>{var e;return null===(e=this.onCellsChecked)||void 0===e?void 0:e.call(this)}));const e=this.resultLine.getElement(),t=this.viewHtmlElementCreator.getElement().querySelector(".game__puzzle");null==t||t.append(e)}renderGameSource(){const e=(new i).getElement(),t=this.viewHtmlElementCreator.getElement().querySelector(".game__puzzle");null==t||t.after(e)}renderGameSourceLine(){this.gameSourceLine=new r((()=>{var e;return null===(e=this.onCellsChecked)||void 0===e?void 0:e.call(this)}));const e=this.gameSourceLine.getElement(),t=this.viewHtmlElementCreator.getElement().querySelector(".game__source");null==t||t.append(e)}renderGameCells(){const e=()=>{var e;return null===(e=this.onCellsChecked)||void 0===e?void 0:e.call(this)},t=this.controller.getTextExample();if(this.cells=[],t){const n=a.shuffle(t.split(" ")),l=[];n.forEach(((n,o)=>{const s=new u(n,o,t,e);this.cells.push(s),l.push(s.getElement())}));const o=this.viewHtmlElementCreator.getElement().querySelector(".source__row");o&&(o.innerHTML="",o.append(...l),this.renderImageToCell())}}renderImageToCell(e=!1){const t=this.controller.getCurrentWordIndex(),n=this.controller.getImagePath();_.createImages(-t,`[data-is-result-block="${e}"]`,"game__puzzle",n||"",this.controller)}renderToolBarBottom(){this.buttonContinue=new A((()=>{var e;return null===(e=this.onHandleClickContinue)||void 0===e?void 0:e.call(this)})),this.buttonCheck=new R((()=>{var e;return null===(e=this.onHandleClickCheck)||void 0===e?void 0:e.call(this)})),this.buttonAutoComplete=new I((()=>{var e;return null===(e=this.onHandleClickAutoComplete)||void 0===e?void 0:e.call(this)}));const e=(new c).getElement();[this.buttonContinue,this.buttonCheck,this.buttonAutoComplete].forEach((t=>{e.append(t.getElement())}));const t=this.viewHtmlElementCreator.getElement().querySelector(".game__source");null==t||t.after(e)}setHintText(){var e;const t=null===(e=this.hintText)||void 0===e?void 0:e.getElement(),n=this.controller.getCurrentWordInfo();t&&n&&(t.textContent=n.textExampleTranslate)}renderPronunciationHint(){const e=(new T).getElement();this.buttonAudioHint=new z((()=>{var e;return null===(e=this.onHandleClickAudioSound)||void 0===e?void 0:e.call(this)})),this.hintText=new G,this.setHintText(),[this.buttonAudioHint,this.hintText].forEach((t=>{e.append(t.getElement())})),this.viewHtmlElementCreator.getElement().prepend(e)}renderToolBarTopMain(){var e;const t=Object.keys(g).length,n=null===(e=this.controller.getGameData())||void 0===e?void 0:e.length;n&&(this.toolBarTopMain=new J(t,n,this.savedLevel,this.savedRound,this.subject),this.viewHtmlElementCreator.getElement().prepend(this.toolBarTopMain.getElement()),this.controller.eventController.setupLevelAndRoundHandler())}}}}]);