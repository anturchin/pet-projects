"use strict";(self.webpackChunke_commerce=self.webpackChunke_commerce||[]).push([[17],{398:(t,e,s)=>{s.r(e),s.d(e,{ProductController:()=>L});var n=s(940);class r extends n.S{constructor(t){super({tag:"img",classNames:["card__img"]}),this.setImgPath(t)}setImgPath(t){this.viewHtmlElement.getElement().setAttribute("src",t)}}class o extends n.S{constructor(t){super({tag:"h4",classNames:["card__title"],textContent:t})}}class a extends n.S{constructor(t){super({tag:"p",classNames:["card__description"],textContent:t})}}var i=s(310);class c extends n.S{constructor(t){super({tag:"p",classNames:["card__price-product"],textContent:t})}}class d extends n.S{constructor(t){super({tag:"p",classNames:["cards__sale-price"],textContent:t})}}class u extends n.S{constructor(){super({tag:"button",classNames:["custom-button"],textContent:"Add bag"})}}class l extends n.S{constructor(){super({tag:"button",classNames:["custom-button"],textContent:"Remove"})}}class h extends n.S{constructor(t,e,s,n,r,o){super({tag:"div",classNames:["product__card"],id:o}),this.setupCard(t,e,s,n,r)}setupCard(t,e,s,n,h){const m=new r(t).getElement();this.viewHtmlElement.addInnerElement(m);const p=new o(e).getElement();this.viewHtmlElement.addInnerElement(p);const g=new a(s).getElement();this.viewHtmlElement.addInnerElement(g);const f=new c(n).getElement(),v=new d(h).getElement(),y=(new i.m).getElement();y.append(f,v);const P=(new l).getElement(),C=(new u).getElement(),w=(new i.m).getElement();w.append(C,P),this.viewHtmlElement.addInnerElement(y),this.viewHtmlElement.addInnerElement(w)}}class m extends n.S{constructor(t){super({tag:"div",classNames:["card-list-bag"]}),this.cards=[],this.setupCardList(t)}getCardList(){return this.cards}setupCardList(t){this.cards=[],t.forEach((t=>{const{url:e,name:s,description:n,price:r,sale:o,id:a}=t,i=new h(e,s,n,r,o,a);this.cards.push(i)})),this.getElement().append(...this.cards.map((t=>t.getElement())))}}var p=s(241);class g extends n.S{constructor(){super({tag:"section",classNames:["products"]}),this.productList=null,this.currentPage=1,this.itemsPage=4,this.allProduct=[]}renderProductList(t){this.allProduct=t,this.createControls(),this.renderCurrentPage()}renderCurrentPage(){const t=(this.currentPage-1)*this.itemsPage,e=t+this.itemsPage,s=this.allProduct.slice(t,e);this.productList&&(this.productList.getElement().innerHTML=""),this.productList=new m(s),this.viewHtmlElement.addInnerElement(this.productList.getElement()),this.disableBtns()}updateCurrentPage(){var t;const e=(this.currentPage-1)*this.itemsPage,s=e+this.itemsPage,n=this.allProduct.slice(e,s);this.productList&&(this.productList.getElement().innerHTML=""),null===(t=this.productList)||void 0===t||t.setupCardList(n),this.disableBtns()}createControls(){const t=document.createElement("div");t.classList.add("pagination-controls");const e=document.createElement("button");e.classList.add("pagination__btn"),e.textContent="Previous",e.disabled=1===this.currentPage,e.onclick=()=>{this.prevPage(),this.updateControls(t)};const s=document.createElement("button");s.classList.add("pagination__btn"),s.textContent="Next",s.disabled=this.currentPage*this.itemsPage>=this.allProduct.length,s.onclick=()=>{this.nextPage(),this.updateControls(t)};const n=document.createElement("input");n.classList.add("pagination__input"),n.type="number",n.min="1",n.max=`${Math.ceil(this.allProduct.length/this.itemsPage)}`,n.value=`${this.currentPage}`,n.onchange=()=>{const e=parseInt(n.value,10);this.goToPage(e),this.updateControls(t)},t.append(e),t.append(n),t.append(s),this.viewHtmlElement.addInnerElement(t)}updateControls(t){const e=t.querySelector("button:first-of-type"),s=t.querySelector("button:last-of-type"),n=t.querySelector("input");e.disabled=1===this.currentPage,s.disabled=this.currentPage*this.itemsPage>=this.allProduct.length,n.value=`${this.currentPage}`}getWrapperList(){return this.productList}nextPage(){this.currentPage*this.itemsPage<this.allProduct.length&&(this.currentPage+=1,this.updateCurrentPage())}prevPage(){this.currentPage>1&&(this.currentPage-=1,this.updateCurrentPage())}goToPage(t){t>0&&t<=Math.ceil(this.allProduct.length/this.itemsPage)&&(this.currentPage=t,this.updateCurrentPage())}disableBtns(){const t=document.getElementsByClassName("custom-button");for(let e=2;e<t.length;e+=2)t[e].disabled=!0;const e=p.q.getProduct();e&&JSON.parse(e).forEach((t=>{const e=document.getElementById(t);if(e){const t=e.getElementsByClassName("custom-button")[0],s=e.getElementsByClassName("custom-button")[1];t&&s&&this.disableOrActivateBtns(t,s)}}))}disableOrActivateBtns(t,e){const s=e;t.disabled=!0,s.disabled=!1}}var f=s(874);class v{static getFilteredList(t,e){return s=this,n=void 0,o=function*(){const s=new URL(`${this.projectKey}/products`,`${this.API_URL}/`);e&&s.searchParams.append("where",e);try{const e=yield fetch(s,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-type":"application/json"}});if(!e.ok){const t=yield e.json();return{statusCode:t.statusCode,msg:t.message}}return yield e.json()}catch(t){throw t instanceof Error&&console.error(t.message),t}},new((r=void 0)||(r=Promise))((function(t,e){function a(t){try{c(o.next(t))}catch(t){e(t)}}function i(t){try{c(o.throw(t))}catch(t){e(t)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof r?s:new r((function(t){t(s)}))).then(a,i)}c((o=o.apply(s,n||[])).next())}));var s,n,r,o}}v.projectKey="fad-team",v.API_URL="https://api.europe-west1.gcp.commercetools.com";var y=s(254),P=s(802),C=s(430),w=s(490),E=function(t,e,s,n){return new(s||(s=Promise))((function(r,o){function a(t){try{c(n.next(t))}catch(t){o(t)}}function i(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,i)}c((n=n.apply(t,e||[])).next())}))};const b=["phone","laptop","watch","tablet"];class L{constructor(t){this.page=new g,this.imgView=new C.p,this.products=[],this.discount=0,this.cart=[],this.loadData(),this.productType=t,this.productIndex=b.findIndex((t=>t===this.productType))}getElement(){return this.page.getElement()}loadData(){return E(this,void 0,void 0,(function*(){const t=p.q.getToken();if(t){const e=yield f.M.getCategoryList(t),s=yield w.f.getDiscounts(t);if("results"in s){const[t]=s.results;this.discount=1-t.value.permyriad/1e4}if("results"in e){const s=`masterData(current(categories(id="${e.results[this.productIndex].id}")))`,n=yield v.getFilteredList(t,s);if("results"in n){this.products=n.results;const t=this.getProps();this.page.renderProductList(t),this.disableDuplicateButtons(),this.eventHandler()}}}}))}getProps(){return this.products.map((t=>{var e,s,n;const r=null===(e=t.masterData.current.masterVariant.prices[0])||void 0===e?void 0:e.value.centAmount,o=void 0!==r?r/100:0;return 0!==this.discount?{url:(null===(s=t.masterData.current.masterVariant.images[0])||void 0===s?void 0:s.url)||"",name:t.masterData.current.name.ru,description:t.masterData.current.metaDescription.ru,price:`${o}$`,sale:`${Math.round(o*this.discount)}$`,id:t.id}:{url:(null===(n=t.masterData.current.masterVariant.images[0])||void 0===n?void 0:n.url)||"",name:t.masterData.current.name.ru,description:t.masterData.current.metaDescription.ru,price:`${o}$`,sale:`${Math.round(.05*Number(o))}$`,id:t.id}}))}eventHandler(){var t,e;const s=null===(e=null===(t=this.page)||void 0===t?void 0:t.getWrapperList())||void 0===e?void 0:e.getElement();s?s.addEventListener("click",this.onClickHandler.bind(this)):console.error("Category list element not found!")}onClickHandler(t){const e=t.target.closest(".product__card");if(!e)return;const s=e.getAttribute("id");if(s)if("BUTTON"===t.target.tagName){const[e,n]=this.getBtns(s);t.target===e&&this.buttonClickHandler(s,"add"),t.target===n&&this.buttonClickHandler(s,"remove")}else this.openDetailedPage(s)}openDetailedPage(t){console.log("detailed page for:",t)}buttonClickHandler(t,e){return E(this,void 0,void 0,(function*(){const[s,n]=this.getBtns(t),r=p.q.getProduct();let o=[];r&&(o=JSON.parse(r));let a=1,i={action:"addLineItem",productId:t,quantity:a};if("add"===e&&(this.cart.push(t),o.push(t),s.disabled=!0,n.disabled=!1),"remove"===e){const e=this.cart.indexOf(t);this.cart.splice(e,1),o.splice(e,1),a=0,s.disabled=!1,n.disabled=!0,i={action:"changeLineItemQuantity",lineItemId:t,quantity:a}}p.q.saveProduct(JSON.stringify(o)),this.imgView.updateNumber();const c=p.q.getToken();if(c){const s=p.q.getCartId();if(s){const n=yield P.m.getCart(c,s);if("version"in n){const{version:r}=n;if("remove"===e){const e=n.lineItems.find((e=>e.productId===t));e&&(i={action:"changeLineItemQuantity",lineItemId:e.id,quantity:a})}yield y.H.updateCart(c,s,r,i)}}}}))}disableDuplicateButtons(){const t=p.q.getProduct();t&&JSON.parse(t).forEach((t=>{const[e,s]=this.getBtns(t);e&&s&&(e.disabled=!0,s.disabled=!1)}))}getBtns(t){const e=document.getElementById(t);return[null==e?void 0:e.getElementsByClassName("custom-button")[0],null==e?void 0:e.getElementsByClassName("custom-button")[1]]}}},802:(t,e,s)=>{s.d(e,{m:()=>n});class n{static getCart(t,e){return s=this,n=void 0,o=function*(){let s=new URL(`${this.projectKey}/carts`,`${this.API_URL}/`);if(e){s=new URL(`${this.projectKey}/carts/${e}`,`${this.API_URL}/`);try{const e=yield fetch(s,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-type":"application/json"}});if(!e.ok){const t=yield e.json();return{statusCode:t.statusCode,msg:t.message}}return yield e.json()}catch(t){throw t instanceof Error&&console.error(t.message),t}}else try{const e=yield fetch(s,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-type":"application/json"}});if(!e.ok){const t=yield e.json();return{statusCode:t.statusCode,msg:t.message}}return yield e.json()}catch(t){throw t instanceof Error&&console.error(t.message),t}},new((r=void 0)||(r=Promise))((function(t,e){function a(t){try{c(o.next(t))}catch(t){e(t)}}function i(t){try{c(o.throw(t))}catch(t){e(t)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof r?s:new r((function(t){t(s)}))).then(a,i)}c((o=o.apply(s,n||[])).next())}));var s,n,r,o}}n.projectKey="fad-team",n.API_URL="https://api.europe-west1.gcp.commercetools.com"},254:(t,e,s)=>{s.d(e,{H:()=>n});class n{static updateCart(t,e,s,n){return r=this,o=void 0,i=function*(){const r=`${this.API_URL}/${this.projectKey}/carts/${e}`,o={version:s,actions:[n]};try{const e=yield fetch(r,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-type":"application/json"},body:JSON.stringify(o)});if(!e.ok){const t=yield e.json();return{statusCode:t.statusCode,msg:t.message}}return yield e.json()}catch(t){throw t instanceof Error&&console.error(t.message),t}},new((a=void 0)||(a=Promise))((function(t,e){function s(t){try{c(i.next(t))}catch(t){e(t)}}function n(t){try{c(i.throw(t))}catch(t){e(t)}}function c(e){var r;e.done?t(e.value):(r=e.value,r instanceof a?r:new a((function(t){t(r)}))).then(s,n)}c((i=i.apply(r,o||[])).next())}));var r,o,a,i}}n.projectKey="fad-team",n.API_URL="https://api.europe-west1.gcp.commercetools.com"},874:(t,e,s)=>{s.d(e,{M:()=>n});class n{static getCategoryList(t){return e=this,s=void 0,r=function*(){const e=`${this.API_URL}/${this.projectKey}/categories`;try{const s=yield fetch(e,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-type":"application/json"}});if(!s.ok){const t=yield s.json();return{statusCode:t.statusCode,msg:t.message}}return yield s.json()}catch(t){throw t instanceof Error&&console.error(t.message),t}},new((n=void 0)||(n=Promise))((function(t,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function i(t){try{c(r.throw(t))}catch(t){o(t)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(t){t(s)}))).then(a,i)}c((r=r.apply(e,s||[])).next())}));var e,s,n,r}}n.projectKey="fad-team",n.API_URL="https://api.europe-west1.gcp.commercetools.com"},490:(t,e,s)=>{s.d(e,{f:()=>n});class n{static getDiscounts(t){return e=this,s=void 0,r=function*(){const e=`${this.API_URL}/${this.projectKey}/product-discounts`;try{const s=yield fetch(e,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-type":"application/json"}});if(!s.ok){const t=yield s.json();return{statusCode:t.statusCode,msg:t.message}}return yield s.json()}catch(t){throw t instanceof Error&&console.error(t.message),t}},new((n=void 0)||(n=Promise))((function(t,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function i(t){try{c(r.throw(t))}catch(t){o(t)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(t){t(s)}))).then(a,i)}c((r=r.apply(e,s||[])).next())}));var e,s,n,r}}n.projectKey="fad-team",n.API_URL="https://api.europe-west1.gcp.commercetools.com"},310:(t,e,s)=>{s.d(e,{m:()=>r});var n=s(940);class r extends n.S{constructor(){super({tag:"div",classNames:["container","conteinerInfo"]})}}}}]);