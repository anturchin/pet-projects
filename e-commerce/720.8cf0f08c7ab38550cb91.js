"use strict";(self.webpackChunke_commerce=self.webpackChunke_commerce||[]).push([[720],{781:(t,e,n)=>{n.r(e),n.d(e,{BagController:()=>D});var s=n(940);class i extends s.S{constructor(t){super({tag:"img",classNames:["cardbag-img"]}),this.setImgPath(t)}setImgPath(t){this.viewHtmlElement.getElement().setAttribute("src",t)}}class o extends s.S{constructor(t){super({tag:"h4",classNames:["card__title-bag"],textContent:t})}}class r extends s.S{constructor(t,e=0,n=100){super({tag:"div",classNames:["quantity-input__container"]}),this.inputElement=document.createElement("input"),this.plusButton=document.createElement("button"),this.minusButton=document.createElement("button"),this.setupInput(t,e,n),this.setupBtns()}setupInput(t,e,n){this.inputElement.classList.add("quantity-input"),this.inputElement.type="number",this.inputElement.min=`${e}`,this.inputElement.max=`${n}`,this.inputElement.value=`${t}`,this.inputElement.onchange=()=>{const t=parseInt(this.inputElement.value,10);console.log(`Количество: ${t}`)}}setupBtns(){this.plusButton.innerText="+",this.plusButton.classList.add("quantity-btn"),this.plusButton.id="quantity-btn-plus",this.plusButton.addEventListener("click",(()=>this.changeQuantity(1))),this.minusButton.innerText="-",this.minusButton.classList.add("quantity-btn"),this.minusButton.id="quantity-btn-minus",this.minusButton.addEventListener("click",(()=>this.changeQuantity(-1))),this.viewHtmlElement.addInnerElement(this.minusButton),this.viewHtmlElement.addInnerElement(this.inputElement),this.viewHtmlElement.addInnerElement(this.plusButton)}changeQuantity(t){let e=parseInt(this.inputElement.value,10)+t;const n=parseInt(this.inputElement.min,10),s=parseInt(this.inputElement.max,10);e<n&&(e=n),e>s&&(e=s),this.inputElement.value=`${e}`}}class a extends s.S{constructor(t){super({tag:"p",classNames:["card__price"],textContent:t})}}class c extends s.S{constructor(t){super({tag:"p",classNames:["card__sale-price"],textContent:t})}}class l extends s.S{constructor(){super({tag:"button",classNames:["btn-delete"],textContent:"X"})}}class u extends s.S{constructor(t,e,n,s,i,o){super({tag:"div",classNames:["cardbag"],id:i}),this.setupCardBag(t,e,n,s,o)}setupCardBag(t,e,n,s,u){const d=new i(t).getElement();this.viewHtmlElement.addInnerElement(d);const h=new o(e).getElement();this.viewHtmlElement.addInnerElement(h);const m=new r(u,0,100).getElement();this.viewHtmlElement.addInnerElement(m);const p=new a(n).getElement();this.viewHtmlElement.addInnerElement(p);const g=new c(s).getElement();this.viewHtmlElement.addInnerElement(g);const y=(new l).getElement();this.viewHtmlElement.addInnerElement(y)}}class d extends s.S{constructor(){super({tag:"div",classNames:["card-list__bag"]}),this.cardsBag=[]}getCardBagList(){return this.cardsBag}clearBag(){this.cardsBag=[],this.getElement().innerHTML=""}setupCardListBag(t){this.clearBag(),t.forEach((t=>{const{url:e,name:n,price:s,sale:i,id:o,quantity:r}=t,a=new u(e,n,s,i,o,r);this.cardsBag.push(a)})),this.getElement().append(...this.cardsBag.map((t=>t.getElement())))}hide(){this.getElement().style.display="none"}show(){this.getElement().style.display=""}}class h extends s.S{constructor(){super({tag:"button",classNames:["custom-button-delete"],textContent:"Empty trash"})}hide(){this.getElement().style.display="none"}show(){this.getElement().style.display="block"}}var m=n(310);class p extends s.S{constructor(){super({tag:"h4",classNames:["price__title"],textContent:"Amount payable:"})}}class g extends s.S{constructor(t){super({tag:"p",classNames:["price"],textContent:t})}updatePrice(t){this.viewHtmlElement.getElement().textContent=t}}class y extends s.S{constructor(t){super({tag:"input",classNames:["input-promo"]}),this.value="",this.setupInput(t),this.onChange=this.onChange.bind(this),this.setEventListener()}getValue(){return this.value}onChange(t){this.value=t.target.value}setEventListener(){this.getElement().addEventListener("change",this.onChange)}setupInput(t){const e=this.getElement();e.setAttribute("type",t.type),e.setAttribute("placeholder",t.label),t.required&&e.setAttribute("required","true")}}class E extends s.S{constructor(){super({tag:"button",classNames:["custom-button"],textContent:"Make an order"})}}class v extends s.S{constructor(){super({tag:"button",classNames:["custom-button"],textContent:"Check"})}}class f extends s.S{constructor(t){super({tag:"p",classNames:["sale-price"],textContent:t})}updatePrice(t){this.viewHtmlElement.getElement().textContent=t}}class w extends s.S{constructor(t,e){super({tag:"div",classNames:["container-price"]}),this.promo=null,this.fullPrice=null,this.salePrice=null,this.setupContainer(t,e)}getFormElem(){return this.promo?{promo:this.promo}:null}updatePrice(t){this.fullPrice&&this.fullPrice.updatePrice(t)}updateDiscountedPrice(t){if(this.fullPrice){const t=this.fullPrice.getElement();t.classList.contains("change-price")||t.classList.add("change-price")}this.salePrice&&this.salePrice.updatePrice(t)}setupContainer(t,e){const n=(new p).getElement();this.fullPrice=new g(t);const s=this.fullPrice.getElement(),i=(new m.m).getElement();i.append(n,s),this.viewHtmlElement.addInnerElement(i);const o=(new m.m).getElement();this.promo=new y({type:"text",label:"Promocode",required:!1});const r=this.promo.getElement(),a=(new v).getElement();o.append(r,a),this.viewHtmlElement.addInnerElement(o),this.salePrice=new f(e);const c=this.salePrice.getElement();this.viewHtmlElement.addInnerElement(c);const l=(new E).getElement();this.viewHtmlElement.addInnerElement(l)}hide(){this.getElement().style.display="none"}show(){this.getElement().style.display=""}}const C=n.p+"images/3225130..svg";class P extends s.S{constructor(){super({tag:"img",classNames:["empty__img"]}),this.setImgPath()}setImgPath(){this.viewHtmlElement.getElement().setAttribute("src",C)}}class I extends s.S{constructor(){super({tag:"h3",classNames:["subtitle-empty"],textContent:"Your cart is currently empty. Would you like to do some shopping?"})}}class x extends s.S{constructor(t){super({tag:"button",classNames:["custom-button"],textContent:"Go shopping"}),this.router=t,this.redirectToCategory=this.redirectToCategory.bind(this),this.setupPath()}redirectToCategory(){return t=this,e=void 0,s=function*(){var t;yield null===(t=this.router)||void 0===t?void 0:t.navigate("category")},new((n=void 0)||(n=Promise))((function(i,o){function r(t){try{c(s.next(t))}catch(t){o(t)}}function a(t){try{c(s.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}c((s=s.apply(t,e||[])).next())}));var t,e,n,s}setupPath(){this.getElement().addEventListener("click",this.redirectToCategory)}}class b extends s.S{constructor(){super({tag:"div",classNames:["container__empty-bag"]})}setupContainer(t){this.clearContainer();const e=(new P).getElement();this.viewHtmlElement.addInnerElement(e);const n=(new I).getElement();this.viewHtmlElement.addInnerElement(n);const s=new x(t).getElement();this.viewHtmlElement.addInnerElement(s)}clearContainer(){this.getElement().innerHTML=""}hide(){this.getElement().style.display="none"}show(){this.getElement().style.display=""}}var L=n(141);class B extends s.S{constructor(t){super({tag:"section",classNames:["bag"]}),this.productBag=new d,this.emptyBagMessage=new b,this.priceContainer=null,this.router=t,this.createPriceContainer("0$","0$"),this.loading=new L.T,this.viewHtmlElement.addInnerElement(this.loading.getElement()),this.btnDelete=new h,this.btnDelete.hide(),this.viewHtmlElement.addInnerElement(this.btnDelete.getElement()),this.viewHtmlElement.addInnerElement(this.emptyBagMessage.getElement())}renderProductBagList(t){var e;0===t.length?(null===(e=this.emptyBagMessage)||void 0===e||e.setupContainer(this.router),this.emptyBagMessage.show(),this.productBag.hide(),this.priceContainer&&this.priceContainer.hide(),this.btnDelete&&this.btnDelete.hide()):(this.emptyBagMessage.hide(),this.productBag.setupCardListBag(t),this.viewHtmlElement.addInnerElement(this.productBag.getElement()),this.priceContainer&&this.priceContainer.show(),this.btnDelete&&this.btnDelete.show())}getWrapperList(){return this.productBag}createPriceContainer(t,e){this.priceContainer=new w(t,e),this.priceContainer.hide();const n=this.priceContainer.getElement();this.viewHtmlElement.addInnerElement(n)}updatePrice(t){this.priceContainer&&this.priceContainer.updatePrice(t)}updateDiscountedPrice(t){this.priceContainer&&this.priceContainer.updateDiscountedPrice(t)}showLoader(){this.loading.show()}hideLoader(){this.loading.hide()}}var $=n(241),H=n(802),q=n(254);class k{static deleteCart(t,e,n){return s=this,i=void 0,r=function*(){const s=`${this.API_URL}/${this.projectKey}/carts/${e}?version=${n}`;try{const e=yield fetch(s,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!e.ok){const t=yield e.json();return{statusCode:t.statusCode,msg:t.message}}return yield e.json()}catch(t){throw t instanceof Error&&console.error(t.message),t}},new((o=void 0)||(o=Promise))((function(t,e){function n(t){try{c(r.next(t))}catch(t){e(t)}}function a(t){try{c(r.throw(t))}catch(t){e(t)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof o?s:new o((function(t){t(s)}))).then(n,a)}c((r=r.apply(s,i||[])).next())}));var s,i,o,r}}k.projectKey="fad-team",k.API_URL="https://api.europe-west1.gcp.commercetools.com";var A=n(66),j=n(490);class T{static getPromo(t,e){return n=this,s=void 0,o=function*(){let n=new URL(`${this.projectKey}/cart-discounts`,`${this.API_URL}/`);if(e){n=new URL(`${this.projectKey}/cart-discounts/${e}`,`${this.API_URL}/`);try{const e=yield fetch(n,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-type":"application/json"}});if(!e.ok){const t=yield e.json();return{statusCode:t.statusCode,msg:t.message}}return yield e.json()}catch(t){throw t instanceof Error&&console.error(t.message),t}}else try{const e=yield fetch(n,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-type":"application/json"}});if(!e.ok){const t=yield e.json();return{statusCode:t.statusCode,msg:t.message}}return yield e.json()}catch(t){throw t instanceof Error&&console.error(t.message),t}},new((i=void 0)||(i=Promise))((function(t,e){function r(t){try{c(o.next(t))}catch(t){e(t)}}function a(t){try{c(o.throw(t))}catch(t){e(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(t){t(n)}))).then(r,a)}c((o=o.apply(n,s||[])).next())}));var n,s,i,o}}T.projectKey="fad-team",T.API_URL="https://api.europe-west1.gcp.commercetools.com";var N=n(430),_=function(t,e,n,s){return new(n||(n=Promise))((function(i,o){function r(t){try{c(s.next(t))}catch(t){o(t)}}function a(t){try{c(s.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}c((s=s.apply(t,e||[])).next())}))};class D{constructor(t){this.products=[],this.totalPrice=0,this.totalDiscountedPrice=0,this.discount=0,this.promoCodes=[],this.promos=[],this.imgView=new N.p,this.promoUsed=!1,this.router=t,this.page=new B(this.router),this.loadData()}getElement(){return this.page.getElement()}loadData(){return _(this,void 0,void 0,(function*(){const t=yield $.q.getToken();if(t){const e=yield j.f.getDiscounts(t);if("results"in e){const[t]=e.results;this.discount=1-t.value.permyriad/1e4}const n=$.q.getCartId();if(n){const e=yield H.m.getCart(t,n);if(console.log(e),"lineItems"in e){const t=e.lineItems.map((t=>t));this.products.push(...t);const n=this.getProps();this.page.renderProductBagList(n),this.eventHandler(),this.promoUsed=!1,yield this.updatePrice(),this.getPromo(),"discountOnTotalPrice"in e&&(this.promoUsed=!0,this.updateDiscountedPrice())}}}}))}getProps(){return this.products.map((t=>{const e=t.variant.images[0].url,n=void 0!==e?e:"",s=t.price.value.centAmount,i=void 0!==s?s/100:0;return 0!==this.discount?{url:n,name:t.name.ru,price:`${i}$`,sale:`${Math.round(i*this.discount)}$`,id:t.productId,quantity:t.quantity}:{url:n,name:t.name.ru,price:`${i}$`,sale:`${Math.round(.05*i)}$`,id:t.productId,quantity:t.quantity}}))}eventHandler(){var t;const e=null===(t=this.page.getWrapperList())||void 0===t?void 0:t.getElement();if(!e)return void console.error("Producrs list element not found!");e.addEventListener("click",this.clickHandler.bind(this));const n=document.getElementsByClassName("custom-button-delete")[0];n&&n.addEventListener("click",this.makeEmptyHandler.bind(this));const s=document.getElementsByClassName("custom-button")[1];s&&s.addEventListener("click",this.checkPromo.bind(this))}clickHandler(t){const e=t.target,n=e.closest(".cardbag"),s=null==n?void 0:n.getAttribute("id");s&&(e.classList.contains("quantity-btn")&&("quantity-btn-minus"===e.id&&this.changeQuantity(s,"minus"),"quantity-btn-plus"===e.id&&this.changeQuantity(s,"plus")),e.classList.contains("btn-delete")&&this.changeQuantity(s,"delete"))}changeQuantity(t,e){return _(this,void 0,void 0,(function*(){const n=$.q.getToken();if(n){const s=$.q.getCartId();if(s){const i=yield H.m.getCart(n,s);if("lineItems"in i){const o=i.lineItems.find((e=>e.productId===t));if(o){let{quantity:t}=o;"minus"===e&&t>0&&(t-=1),"plus"===e&&(t+=1),"delete"===e&&(t=0);const{version:r}=i,a={action:"changeLineItemQuantity",lineItemId:o.id,quantity:t};yield q.H.updateCart(n,s,r,a);const c=yield H.m.getCart(n,s);if("lineItems"in c){$.q.removeProduct();const t=[];c.lineItems.forEach((e=>{t.push(e.productId)})),$.q.saveProduct(JSON.stringify(t));const e=c.lineItems.map((t=>t));this.products=[],this.products.push(...e),this.imgView.updateNumber()}if(this.updatePrice(),this.updateDiscountedPrice(),0===this.products.length){const t=this.page.getWrapperList();t&&t.clearBag()}const l=this.getProps();this.page.renderProductBagList(l),this.hideLoaderAfterDelay()}}}}}))}hideLoaderAfterDelay(){this.page.showLoader(),setTimeout((()=>{this.page.hideLoader()}),300)}updatePrice(){return _(this,void 0,void 0,(function*(){const t=yield $.q.getToken();if(t){const e=$.q.getCartId();if(e){const n=yield H.m.getCart(t,e);this.promoUsed||"totalPrice"in n&&(this.totalPrice=Math.floor(n.totalPrice.centAmount/100),"discountOnTotalPrice"in n&&n.discountOnTotalPrice&&"discountedAmount"in n.discountOnTotalPrice&&(this.totalPrice=Math.floor(n.discountOnTotalPrice.discountedAmount.centAmount/10)),this.page.updatePrice(`${this.totalPrice}$`))}}}))}updateDiscountedPrice(){return _(this,void 0,void 0,(function*(){if(this.promoUsed){const t=yield $.q.getToken();if(t){const e=$.q.getCartId();if(e){const n=yield H.m.getCart(t,e);"totalPrice"in n&&(this.totalDiscountedPrice=Math.floor(n.totalPrice.centAmount/100),this.page.updateDiscountedPrice(`${this.totalDiscountedPrice}$`))}}}}))}makeEmptyHandler(){return _(this,void 0,void 0,(function*(){const t=$.q.getToken();if(t){const e=$.q.getCartId();if(e){$.q.removeCart(),$.q.removeProduct();const n=yield H.m.getCart(t,e);if("version"in n){const{version:s}=n;yield k.deleteCart(t,e,s)}const s=yield A.U.createCart(t);"id"in s&&$.q.saveCartId(s.id)}}}))}getPromo(){return _(this,void 0,void 0,(function*(){const t=$.q.getToken();if(t){const e=yield T.getPromo(t);"results"in e&&(this.promos=e.results.map((t=>(this.promoCodes.push(t.name.ru),t))))}}))}checkPromo(){const t=document.getElementsByClassName("input-promo")[0].value;this.promoCodes.includes(t)?this.addDiscountToCart(t):console.log(`"${t}" promo is incorrect`)}addDiscountToCart(t){return _(this,void 0,void 0,(function*(){const e=$.q.getToken();if(e){const n=$.q.getCartId();if(n){const s={action:"addDiscountCode",code:t},i=yield H.m.getCart(e,n);if("version"in i){const{version:t}=i;console.log(i);const o=yield q.H.updateCart(e,n,t,s);console.log(o),this.promoUsed=!0,this.updateDiscountedPrice()}}}}))}}},802:(t,e,n)=>{n.d(e,{m:()=>s});class s{static getCart(t,e){return n=this,s=void 0,o=function*(){let n=new URL(`${this.projectKey}/carts`,`${this.API_URL}/`);if(e){n=new URL(`${this.projectKey}/carts/${e}`,`${this.API_URL}/`);try{const e=yield fetch(n,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-type":"application/json"}});if(!e.ok){const t=yield e.json();return{statusCode:t.statusCode,msg:t.message}}return yield e.json()}catch(t){throw t instanceof Error&&console.error(t.message),t}}else try{const e=yield fetch(n,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-type":"application/json"}});if(!e.ok){const t=yield e.json();return{statusCode:t.statusCode,msg:t.message}}return yield e.json()}catch(t){throw t instanceof Error&&console.error(t.message),t}},new((i=void 0)||(i=Promise))((function(t,e){function r(t){try{c(o.next(t))}catch(t){e(t)}}function a(t){try{c(o.throw(t))}catch(t){e(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(t){t(n)}))).then(r,a)}c((o=o.apply(n,s||[])).next())}));var n,s,i,o}}s.projectKey="fad-team",s.API_URL="https://api.europe-west1.gcp.commercetools.com"},254:(t,e,n)=>{n.d(e,{H:()=>s});class s{static updateCart(t,e,n,s){return i=this,o=void 0,a=function*(){const i=`${this.API_URL}/${this.projectKey}/carts/${e}`,o={version:n,actions:[s]};try{const e=yield fetch(i,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-type":"application/json"},body:JSON.stringify(o)});if(!e.ok){const t=yield e.json();return{statusCode:t.statusCode,msg:t.message}}return yield e.json()}catch(t){throw t instanceof Error&&console.error(t.message),t}},new((r=void 0)||(r=Promise))((function(t,e){function n(t){try{c(a.next(t))}catch(t){e(t)}}function s(t){try{c(a.throw(t))}catch(t){e(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r((function(t){t(i)}))).then(n,s)}c((a=a.apply(i,o||[])).next())}));var i,o,r,a}}s.projectKey="fad-team",s.API_URL="https://api.europe-west1.gcp.commercetools.com"},490:(t,e,n)=>{n.d(e,{f:()=>s});class s{static getDiscounts(t){return e=this,n=void 0,i=function*(){const e=`${this.API_URL}/${this.projectKey}/product-discounts`;try{const n=yield fetch(e,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-type":"application/json"}});if(!n.ok){const t=yield n.json();return{statusCode:t.statusCode,msg:t.message}}return yield n.json()}catch(t){throw t instanceof Error&&console.error(t.message),t}},new((s=void 0)||(s=Promise))((function(t,o){function r(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof s?n:new s((function(t){t(n)}))).then(r,a)}c((i=i.apply(e,n||[])).next())}));var e,n,s,i}}s.projectKey="fad-team",s.API_URL="https://api.europe-west1.gcp.commercetools.com"},310:(t,e,n)=>{n.d(e,{m:()=>i});var s=n(940);class i extends s.S{constructor(){super({tag:"div",classNames:["container","conteinerInfo"]})}}},141:(t,e,n)=>{n.d(e,{T:()=>o});var s=n(940);class i extends s.S{constructor(){super({tag:"p",classNames:["title-load"],textContent:"Loading..."})}}class o extends s.S{constructor(){super({tag:"div",classNames:["loading"]}),this.setupLoad(),this.hide()}setupLoad(){const t=(new i).getElement();this.viewHtmlElement.addInnerElement(t)}show(){this.viewHtmlElement.getElement().style.display="flex"}hide(){this.viewHtmlElement.getElement().style.display="none"}}}}]);