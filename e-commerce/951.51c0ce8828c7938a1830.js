"use strict";(self.webpackChunke_commerce=self.webpackChunke_commerce||[]).push([[951],{951:(t,e,s)=>{s.r(e),s.d(e,{LoginController:()=>w});class i{static login(t,e){return s=this,i=void 0,r=function*(){const s=`${this.API_URL}/${this.projectKey}/login`;try{const i=yield fetch(s,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(e)});if(!i.ok){const t=yield i.json();return{statusCode:t.statusCode,msg:t.message}}return yield i.json()}catch(t){throw console.error(t),t}},new((n=void 0)||(n=Promise))((function(t,e){function o(t){try{l(r.next(t))}catch(t){e(t)}}function a(t){try{l(r.throw(t))}catch(t){e(t)}}function l(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(t){t(s)}))).then(o,a)}l((r=r.apply(s,i||[])).next())}));var s,i,n,r}}i.projectKey="fad-team",i.API_URL="https://api.europe-west1.gcp.commercetools.com";var n=s(161),r=s(403),o=s(241),a=s(940);class l extends a.S{constructor(t){super({tag:"input",classNames:["input"]}),this.value="",this.setupInput(t),this.onChange=this.onChange.bind(this),this.setEventListener()}getValue(){return this.value}onChange(t){this.value=t.target.value}setEventListener(){this.getElement().addEventListener("change",this.onChange)}setupInput(t){const e=this.getElement();e.setAttribute("type",t.type),e.setAttribute("placeholder",t.label),t.required&&e.setAttribute("required","true")}}class u extends a.S{constructor(t){super({tag:"input",classNames:["input"]}),this.value="",this.setupInput(t),this.onChange=this.onChange.bind(this),this.setEventListener()}getValue(){return this.value}onChange(t){this.value=t.target.value}setEventListener(){this.getElement().addEventListener("change",this.onChange)}setupInput(t){const e=this.getElement();e.setAttribute("type",t.type),e.setAttribute("placeholder",t.label),t.required&&e.setAttribute("required","true")}}class h extends a.S{constructor(t,e){super({tag:"input",classNames:["checkbox-input"]}),this.inputPassword=null,this.inputPassword=e,this.setupInput(t),this.onClick=this.onClick.bind(this),this.setEventListener()}setupInput(t){const e=this.getElement();e.setAttribute("type",t.type),e.setAttribute("placeholder",t.label),t.required&&e.setAttribute("required","true")}onClick(){var t,e;this.getElement().checked?(null===(t=this.inputPassword)||void 0===t?void 0:t.getElement()).type="text":(null===(e=this.inputPassword)||void 0===e?void 0:e.getElement()).type="password"}setEventListener(){this.getElement().addEventListener("click",this.onClick)}}var d=s(848);class c extends a.S{constructor(){super({tag:"H1",classNames:["title"],textContent:"Sign in"})}}class m extends a.S{constructor(){super({tag:"H1",classNames:["subtitle"],textContent:"Show password"})}}class g extends a.S{constructor(){super({tag:"form",classNames:["form"]}),this.title=null,this.inputLogin=null,this.inputPassword=null,this.inputBox=null,this.subtitle=null,this.buttonSubmit=null,this.setupForm()}getFormElements(){return this.title&&this.inputLogin&&this.inputPassword&&this.inputBox&&this.subtitle&&this.buttonSubmit?{inputLogin:this.inputLogin,inputPassword:this.inputPassword,inputBox:this.inputBox,buttonSubmit:this.buttonSubmit,title:this.title,subtitle:this.subtitle}:null}setupForm(){this.title=new c,this.viewHtmlElement.addInnerElement(this.title.getElement()),this.inputLogin=new l({type:"text",label:"Login",required:!1}),this.viewHtmlElement.addInnerElement(this.inputLogin.getElement()),this.inputPassword=new u({type:"password",label:"Password",required:!1}),this.viewHtmlElement.addInnerElement(this.inputPassword.getElement()),this.inputBox=new h({type:"checkbox",label:"",required:!1},this.inputPassword),this.viewHtmlElement.addInnerElement(this.inputBox.getElement()),this.subtitle=new m,this.viewHtmlElement.addInnerElement(this.subtitle.getElement()),this.buttonSubmit=new d.$({label:"Submit"}),this.viewHtmlElement.addInnerElement(this.buttonSubmit.getElement())}}var p=s(861);class E extends a.S{constructor(){super({tag:"section",classNames:["content"]}),this.errorAuth=new p.$,this.buttonRegistration=null,this.loginForm=new g,this.setupLogin()}getForm(){return this.loginForm}getErrorAuth(){return this.errorAuth}getButtonRegistration(){return this.buttonRegistration}setupLogin(){this.viewHtmlElement.addInnerElement(this.loginForm.getElement()),this.buttonRegistration=new d.$({label:"Sign un"}),this.viewHtmlElement.addInnerElement(this.buttonRegistration.getElement()),this.viewHtmlElement.addInnerElement(this.errorAuth.getElement())}}var v=function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};class w{constructor(t,e){this.delay=5e3,this.router=t,this.authPublisher=e,this.page=new E,this.setupFormHandler(),this.redirectToLogin=this.redirectToLogin.bind(this),this.onClickToLogin()}getElement(){return this.page.getElement()}redirectToLogin(){return v(this,void 0,void 0,(function*(){var t;yield null===(t=this.router)||void 0===t?void 0:t.navigate("registration")}))}onClickToLogin(){const t=this.page.getButtonRegistration();t&&t.getElement().addEventListener("click",this.redirectToLogin)}setupFormHandler(){const t=this.page.getForm();t&&t.getElement().addEventListener("submit",(t=>v(this,void 0,void 0,(function*(){t.preventDefault(),yield this.validateForm()}))))}enableBtn(t){const e=this.page.getForm().getFormElements();e&&(e.buttonSubmit.getElement().disabled=t)}closeErrorMessage(t){const e=setTimeout((()=>{t.hideError(),this.enableBtn(!1),clearTimeout(e)}),this.delay)}showError(t,e){t.showError(e),this.enableBtn(!0),this.closeErrorMessage(t)}showErrors(t){const e=this.page.getForm().getFormElements();if(e){if("email"in t){const s=new n.S(t.email);this.showError(s,e.inputLogin.getElement())}if("password"in t){const s=new n.S(t.password);this.showError(s,e.inputPassword.getElement())}}}submitForm(t){return v(this,void 0,void 0,(function*(){const e=o.q.getToken();if(e){const s=yield i.login(e,t);if("customer"in s){const{firstName:t}=s.customer,{id:e}=s.customer;return o.q.saveUserData({firstName:t,id:e}),this.authPublisher.notifyObservers(!0),void(this.router&&(yield this.router.navigate("main")))}"msg"in s&&this.page.getErrorAuth().showMessage(s.msg,s.statusCode)}}))}validateForm(){return v(this,void 0,void 0,(function*(){const t=this.page.getForm().getFormElements();if(!t)return;const e={},s=t.inputLogin.getValue(),i=t.inputPassword.getValue();if(r.B.isValidEmail(s)||(e.email='Invalid email, example: "user@example.com"'),r.B.isValidPassword(i)||(e.password='Invalid password, example: "Password1!"'),Object.keys(e).length>0)this.showErrors(e);else try{yield this.submitForm({email:s,password:i})}catch(t){t instanceof Error&&console.error(t.message)}}))}}},161:(t,e,s)=>{s.d(e,{S:()=>n});var i=s(185);class n{constructor(t){const e={tag:"div",classNames:["error__massage"],textContent:t};this.errorMessageElement=new i.Y(e)}showError(t){this.errorMessageElement&&t.after(this.errorMessageElement.getElement())}hideError(){this.errorMessageElement&&(this.errorMessageElement.getElement().remove(),this.errorMessageElement=null)}}},403:(t,e,s)=>{s.d(e,{B:()=>i});class i{static isValidPostalCode(t,e){switch(t){case"US":return/^\d{5}(?:[-\s]\d{4})?$/.test(e);case"RU":return/^\d{6}$/.test(e);default:return!1}}static isValidCountry(t){return"US"===t||"RU"===t}static isValidAddressType(t){return"Shipping"===t||"Billing"===t}static isValidBirthdate(t,e=13){const s=new Date(t),i=new Date,n=i.getFullYear()-s.getFullYear(),r=i.getMonth()-s.getMonth(),o=i.getDate()-s.getDate();return r<0||0===r&&o<0?n-1>=e:n>=e}static isValidCity(t){return/^[a-zA-Z\s]+$/.test(t)}static isValidStreet(t){return t.length>0}static isValidSurname(t){return/^[a-zA-Z\s]+$/.test(t)&&/[a-zA-Z]/.test(t)}static isValidName(t){return/^[a-zA-Z\s]+$/.test(t)&&/[a-zA-Z]/.test(t)}static isValidEmail(t){return t===t.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}static isValidPassword(t){const e=/[A-Z]/.test(t),s=/[a-z]/.test(t),i=/\d/.test(t),n=/^\S+$/.test(t),r=/[!@#$%^&*]/.test(t);return t.length>=8&&e&&s&&i&&n&&r}static isValidHouse(t){return/^\d+[a-zA-Z]*\/?\d*[a-zA-Z]*$/.test(t)}}},848:(t,e,s)=>{s.d(e,{$:()=>n});var i=s(940);class n extends i.S{constructor(t){super({tag:"button",classNames:["button"]}),this.setupInput(t),this.addClickHandler(t.onClick)}setupInput(t){const e=this.getElement();e.textContent=t.label,t.disabled&&(e.disabled=t.disabled)}addClickHandler(t){t&&this.getElement().addEventListener("click",t)}}},861:(t,e,s)=>{s.d(e,{$:()=>a});var i=s(940);class n extends i.S{constructor(){super({tag:"button",classNames:["error__close"],textContent:"close"})}}class r extends i.S{constructor(){super({tag:"p",classNames:["error__text"]})}}class o extends i.S{constructor(){super({tag:"div",classNames:["modal-error"]})}}class a extends i.S{constructor(){super({tag:"div",classNames:["overlay","hidden"]}),this.errorMessage=new r,this.errorWrapper=new o,this.errorButton=new n,this.setupErrorAuth(),this.setupEvent()}showMessage(t,e){this.errorMessage.getElement().textContent=` [ ${e} ]: ${t}`,this.getElement().classList.remove("hidden")}hideMessage(){this.getElement().classList.add("hidden")}setupEvent(){this.errorButton.getElement().addEventListener("click",(()=>this.hideMessage()))}setupErrorAuth(){this.errorWrapper.getElement().append(this.errorMessage.getElement(),this.errorButton.getElement()),this.addInnerElement(this.errorWrapper.getElement())}}}}]);