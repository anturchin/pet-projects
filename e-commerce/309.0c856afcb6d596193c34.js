"use strict";(self.webpackChunke_commerce=self.webpackChunke_commerce||[]).push([[309],{309:(t,e,s)=>{s.r(e),s.d(e,{RegistrationController:()=>L});class n{static registration(t,e){return s=this,n=void 0,r=function*(){const s=`${this.API_URL}/${this.projectKey}/customers`;try{const n=yield fetch(s,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-type":"application/json"},body:JSON.stringify(e)});if(!n.ok){const t=yield n.json();return{statusCode:t.statusCode,msg:t.message}}return yield n.json()}catch(t){throw console.error(t),t}},new((i=void 0)||(i=Promise))((function(t,e){function a(t){try{u(r.next(t))}catch(t){e(t)}}function o(t){try{u(r.throw(t))}catch(t){e(t)}}function u(e){var s;e.done?t(e.value):(s=e.value,s instanceof i?s:new i((function(t){t(s)}))).then(a,o)}u((r=r.apply(s,n||[])).next())}));var s,n,i,r}}n.projectKey="fad-team",n.API_URL="https://api.europe-west1.gcp.commercetools.com";class i{static addAddress(t,e,s,n){return i=this,r=void 0,o=function*(){try{const i={version:s,actions:[{action:"addAddress",address:{streetName:n.streetName,streetNumber:n.streetNumber,postalCode:n.postalCode,city:n.city,country:n.country}}]},r=yield fetch(`${this.API_URL}/${this.projectKey}/customers/${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(i)});if(!r.ok){const t=yield r.json();return{statusCode:t.statusCode,msg:t.message}}return yield r.json()}catch(t){throw console.error(t),t}},new((a=void 0)||(a=Promise))((function(t,e){function s(t){try{u(o.next(t))}catch(t){e(t)}}function n(t){try{u(o.throw(t))}catch(t){e(t)}}function u(e){var i;e.done?t(e.value):(i=e.value,i instanceof a?i:new a((function(t){t(i)}))).then(s,n)}u((o=o.apply(i,r||[])).next())}));var i,r,a,o}}i.projectKey="fad-team",i.API_URL="https://api.europe-west1.gcp.commercetools.com";class r{static setDefaultAddress(t,e,s,n,i){return r=this,a=void 0,u=function*(){const r={version:n,actions:[{action:`setDefault${t}Address`,addressId:i.id}]};try{const t=yield fetch(`${this.API_URL}/${this.projectKey}/customers/${s}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(r)});if(!t.ok){const e=yield t.json();return{statusCode:e.statusCode,msg:e.message}}return yield t.json()}catch(t){throw console.error(t),t}},new((o=void 0)||(o=Promise))((function(t,e){function s(t){try{i(u.next(t))}catch(t){e(t)}}function n(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){var i;e.done?t(e.value):(i=e.value,i instanceof o?i:new o((function(t){t(i)}))).then(s,n)}i((u=u.apply(r,a||[])).next())}));var r,a,o,u}}r.projectKey="fad-team",r.API_URL="https://api.europe-west1.gcp.commercetools.com";var a=s(161),o=s(403),u=s(241),l=s(848),h=s(861),d=s(940);class p extends d.S{constructor(t){super({tag:"input",classNames:["input"]}),this.value="",this.setupInput(t),this.onChange=this.onChange.bind(this),this.setEventListener()}getValue(){return this.value}onChange(t){this.value=t.target.value}setEventListener(){this.getElement().addEventListener("change",this.onChange)}setupInput(t){const e=this.getElement();e.setAttribute("type",t.type),e.setAttribute("placeholder",t.label),t.required&&e.setAttribute("required","true")}}class c extends d.S{constructor(t){super({tag:"input",classNames:["input"]}),this.value="",this.setupInput(t),this.onChange=this.onChange.bind(this),this.setEventListener()}getValue(){return this.value}onChange(t){this.value=t.target.value}setEventListener(){this.getElement().addEventListener("change",this.onChange)}setupInput(t){const e=this.getElement();e.setAttribute("type",t.type),e.setAttribute("placeholder",t.label),t.required&&e.setAttribute("required","true")}}class m extends d.S{constructor(t){super({tag:"input",classNames:["input"]}),this.value="",this.setupInput(t),this.onChange=this.onChange.bind(this),this.setEventListener()}getValue(){return this.value}onChange(t){this.value=t.target.value}setEventListener(){this.getElement().addEventListener("change",this.onChange)}setupInput(t){const e=this.getElement();e.setAttribute("type",t.type),e.setAttribute("placeholder",t.label),t.required&&e.setAttribute("required","true")}}class g extends d.S{constructor(t){super({tag:"input",classNames:["input"]}),this.value="",this.setupInput(t),this.onChange=this.onChange.bind(this),this.setEventListener()}getValue(){return this.value}onChange(t){this.value=t.target.value}setEventListener(){this.getElement().addEventListener("change",this.onChange)}setupInput(t){const e=this.getElement();e.setAttribute("type",t.type),e.setAttribute("placeholder",t.label),t.required&&e.setAttribute("required","true")}}class E extends d.S{constructor(){super({tag:"form",classNames:["form"]}),this.inputName=null,this.inputMail=null,this.inputSurname=null,this.inputPassword=null,this.buttonSubmit=null,this.setupForm()}getFormElements(){return this.inputName&&this.inputMail&&this.inputSurname&&this.inputPassword&&this.buttonSubmit?{inputName:this.inputName,inputMail:this.inputMail,inputSurname:this.inputSurname,inputPassword:this.inputPassword,buttonSubmit:this.buttonSubmit}:null}setupForm(){this.inputMail=new p({type:"text",label:"fad@gmail.com",required:!1}),this.viewHtmlElement.addInnerElement(this.inputMail.getElement()),this.inputName=new c({type:"text",label:"Your Name",required:!1}),this.viewHtmlElement.addInnerElement(this.inputName.getElement()),this.inputSurname=new m({type:"text",label:"Your Surname",required:!1}),this.viewHtmlElement.addInnerElement(this.inputSurname.getElement()),this.inputPassword=new g({type:"text",label:"Password",required:!1}),this.viewHtmlElement.addInnerElement(this.inputPassword.getElement()),this.buttonSubmit=new l.$({label:"Submit"}),this.viewHtmlElement.addInnerElement(this.buttonSubmit.getElement())}}class v extends d.S{constructor(){super({tag:"option"})}}class y extends d.S{constructor(t){super({tag:"select",classNames:["input"]}),this.value="",this.setupInput(t),this.onChange=this.onChange.bind(this),this.setEventListener()}getValue(){return this.value}onChange(t){this.value=t.target.value}setEventListener(){this.getElement().addEventListener("change",this.onChange)}setupInput(t){const e=this.getElement();e.name="Country",t.required&&e.setAttribute("required","true");const s=new v;s.getElement().setAttribute("disabled","true"),s.getElement().setAttribute("selected","true"),s.getElement().textContent="Select a country",e.appendChild(s.getElement()),t.options.forEach((t=>{const s=new v;s.getElement().setAttribute("value",t),s.getElement().textContent=t,e.appendChild(s.getElement())}))}}class b extends d.S{constructor(t){super({tag:"input",classNames:["input"]}),this.value="",this.setupInput(t),this.onChange=this.onChange.bind(this),this.setEventListener()}getValue(){return this.value}onChange(t){this.value=t.target.value}setEventListener(){this.getElement().addEventListener("change",this.onChange)}setupInput(t){const e=this.getElement();e.setAttribute("type",t.type),e.setAttribute("placeholder",t.label),t.required&&e.setAttribute("required","true")}}class w extends d.S{constructor(t){super({tag:"input",classNames:["input"]}),this.value="",this.setupInput(t),this.onChange=this.onChange.bind(this),this.setEventListener()}getValue(){return this.value}onChange(t){this.value=t.target.value}setEventListener(){this.getElement().addEventListener("change",this.onChange)}setupInput(t){const e=this.getElement();e.setAttribute("type",t.type),e.setAttribute("placeholder",t.label),t.required&&e.setAttribute("required","true")}}class C extends d.S{constructor(t){super({tag:"input",classNames:["input"]}),this.value="",this.setupInput(t),this.onChange=this.onChange.bind(this),this.setEventListener()}getValue(){return this.value}onChange(t){this.value=t.target.value}setEventListener(){this.getElement().addEventListener("change",this.onChange)}setupInput(t){const e=this.getElement();e.setAttribute("type",t.type),e.setAttribute("placeholder",t.label),t.required&&e.setAttribute("required","true")}}class A extends d.S{constructor(t){super({tag:"input",classNames:["input"]}),this.value="",this.setupInput(t),this.onChange=this.onChange.bind(this),this.setEventListener()}getValue(){return this.value}onChange(t){this.value=t.target.value}setEventListener(){this.getElement().addEventListener("change",this.onChange)}setupInput(t){const e=this.getElement();e.setAttribute("type",t.type),e.setAttribute("placeholder",t.label),t.required&&e.setAttribute("required","true")}}class f extends d.S{constructor(t){super({tag:"select",classNames:["input"]}),this.value="",this.setupInput(t),this.onChange=this.onChange.bind(this),this.setEventListener()}getValue(){return this.value}onChange(t){this.value=t.target.value}setEventListener(){this.getElement().addEventListener("change",this.onChange)}setupInput(t){const e=this.getElement();e.name="Address type",t.required&&e.setAttribute("required","true");const s=new v;s.getElement().setAttribute("disabled","true"),s.getElement().setAttribute("selected","true"),s.getElement().textContent="Address type",e.appendChild(s.getElement()),t.options.forEach((t=>{const s=new v;s.getElement().setAttribute("value",t),s.getElement().textContent=t,e.appendChild(s.getElement())}))}}class S extends d.S{constructor(){super({tag:"form",classNames:["form"]}),this.inputCountry=null,this.inputCity=null,this.inputAddressType=null,this.inputStreet=null,this.inputHouse=null,this.inputPostal=null,this.setupForm()}getFormElements(){return this.inputCountry&&this.inputCity&&this.inputAddressType&&this.inputStreet&&this.inputHouse&&this.inputPostal?{inputCountry:this.inputCountry,inputCity:this.inputCity,inputAddressType:this.inputAddressType,inputStreet:this.inputStreet,inputHouse:this.inputHouse,inputPostal:this.inputPostal}:null}setupForm(){this.inputCountry=new y({label:"Choose country",required:!1,options:["RU","US"]}),this.viewHtmlElement.addInnerElement(this.inputCountry.getElement()),this.inputCity=new b({type:"text",label:"City",required:!1}),this.viewHtmlElement.addInnerElement(this.inputCity.getElement()),this.inputAddressType=new f({label:"Address type",required:!1,options:["Billing","Shipping"]}),this.viewHtmlElement.addInnerElement(this.inputAddressType.getElement()),this.inputStreet=new w({type:"text",label:"Street",required:!1}),this.viewHtmlElement.addInnerElement(this.inputStreet.getElement()),this.inputHouse=new C({type:"text",label:"House",required:!1}),this.viewHtmlElement.addInnerElement(this.inputHouse.getElement()),this.inputPostal=new A({type:"text",label:"Postal",required:!1}),this.viewHtmlElement.addInnerElement(this.inputPostal.getElement())}}class I extends d.S{constructor(){super({tag:"section",classNames:["registration-page"]}),this.buttonLogin=null,this.errorAuth=new h.$,this.form=new E,this.addressForm=new S,this.setupRegistration()}getErrorAuth(){return this.errorAuth}getForm(){return this.form}getFormAddress(){return this.addressForm}getButtonLogin(){return this.buttonLogin}setupRegistration(){const t=document.createElement("h1");t.textContent="Create your account",this.viewHtmlElement.addInnerElement(t);const e=this.form.getElement();this.viewHtmlElement.addInnerElement(e);const s=this.addressForm.getElement();this.viewHtmlElement.addInnerElement(s),this.buttonLogin=new l.$({label:"Sign in"}),this.viewHtmlElement.addInnerElement(this.buttonLogin.getElement()),this.viewHtmlElement.addInnerElement(this.errorAuth.getElement())}}var x=function(t,e,s,n){return new(s||(s=Promise))((function(i,r){function a(t){try{u(n.next(t))}catch(t){r(t)}}function o(t){try{u(n.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,o)}u((n=n.apply(t,e||[])).next())}))};class L{constructor(t){this.delay=5e3,this.router=t,this.page=new I,this.setupFormHandler(),this.redirectToLogin=this.redirectToLogin.bind(this),this.onClickToLogin()}getElement(){return this.page.getElement()}redirectToLogin(){return x(this,void 0,void 0,(function*(){var t;yield null===(t=this.router)||void 0===t?void 0:t.navigate("login")}))}onClickToLogin(){const t=this.page.getButtonLogin();t&&t.getElement().addEventListener("click",this.redirectToLogin)}setupFormHandler(){const t=this.page.getForm();t&&t.getElement().addEventListener("submit",(t=>x(this,void 0,void 0,(function*(){t.preventDefault(),yield this.validateForm()}))))}closeErrorMessage(t){const e=setTimeout((()=>{t.hideError(),this.enableBtn(!1),clearTimeout(e)}),this.delay)}showError(t,e){t.showError(e),this.enableBtn(!0),this.closeErrorMessage(t)}showErrors(t){const e=this.page.getForm().getFormElements(),s=this.page.getFormAddress().getFormElements();if(e&&s){if("email"in t){const s=new a.S(t.email);this.showError(s,e.inputMail.getElement())}if("name"in t){const s=new a.S(t.name);this.showError(s,e.inputName.getElement())}if("surname"in t){const s=new a.S(t.surname);this.showError(s,e.inputSurname.getElement())}if("password"in t){const s=new a.S(t.password);this.showError(s,e.inputPassword.getElement())}if("country"in t){const e=new a.S(t.country);this.showError(e,s.inputCountry.getElement())}if("city"in t){const e=new a.S(t.city);this.showError(e,s.inputCity.getElement())}if("addressType"in t){const e=new a.S(t.addressType);this.showError(e,s.inputAddressType.getElement())}if("street"in t){const e=new a.S(t.street);this.showError(e,s.inputStreet.getElement())}if("house"in t){const e=new a.S(t.house);this.showError(e,s.inputHouse.getElement())}if("postalCode"in t){const e=new a.S(t.postalCode);this.showError(e,s.inputPostal.getElement())}}}updateCustomerById(t,e,s,n,a,o,u,l){return x(this,void 0,void 0,(function*(){const h={streetName:n,streetNumber:a,postalCode:o,city:e,country:t},{id:d}=u.customer,{version:p}=u.customer,c=yield i.addAddress(l,d,p,h);if("addresses"in c){const t=yield r.setDefaultAddress(s,l,d,c.version,c.addresses[0]);"msg"in t&&this.page.getErrorAuth().showMessage(t.msg,t.statusCode)}"msg"in c&&this.page.getErrorAuth().showMessage(c.msg,c.statusCode)}))}submitForm(t){return x(this,void 0,void 0,(function*(){const e=u.q.getToken();if(e){const s=yield n.registration(e,t);if("customer"in s){const{firstName:t}=s.customer,{id:n}=s.customer;u.q.saveUserData({firstName:t,id:n});const i=this.page.getFormAddress().getFormElements();if(i){const t=i.inputCountry.getValue(),n=i.inputCity.getValue(),r=i.inputAddressType.getValue(),a=i.inputStreet.getValue(),o=i.inputHouse.getValue(),u=i.inputPostal.getValue();t&&n&&r&&a&&o&&u&&(yield this.updateCustomerById(t,n,r,a,o,u,s,e))}return void(this.router&&(yield this.router.navigate("main")))}"msg"in s&&this.page.getErrorAuth().showMessage(s.msg,s.statusCode)}}))}enableBtn(t){const e=this.page.getForm().getFormElements();e&&(e.buttonSubmit.getElement().disabled=t)}validateForm(){return x(this,void 0,void 0,(function*(){const t=this.page.getForm().getFormElements();if(!t)return;const e={},s=t.inputName.getValue(),n=t.inputSurname.getValue(),i=t.inputMail.getValue(),r=t.inputPassword.getValue();o.B.isValidName(s)||(e.name='Invalid name, example: "John" or "John Doe"'),o.B.isValidSurname(n)||(e.surname='Invalid surname, example: "Smith" or "van der Waals"'),o.B.isValidEmail(i)||(e.email='Invalid email, example: "user@example.com"'),o.B.isValidPassword(r)||(e.password='Invalid password, example: "Password1!"');const a=Object.assign(Object.assign({},e),this.validateFormAddress());if(Object.keys(a).length>0)this.showErrors(a);else try{yield this.submitForm({email:i,firstName:s,lastName:n,password:r})}catch(t){t instanceof Error&&console.error(t.message)}}))}validateFormAddress(){const t={},e=this.page.getFormAddress().getFormElements();if(!e)return t;const s=e.inputCountry.getValue(),n=e.inputCity.getValue(),i=e.inputAddressType.getValue(),r=e.inputStreet.getValue(),a=e.inputHouse.getValue(),u=e.inputPostal.getValue();return(s||n||i||r||a||u)&&(o.B.isValidCountry(s)||(t.country='Invalid country, example: "USA" or "Russia"'),o.B.isValidCity(n)||(t.city='Invalid city, example: "USA" or "Russia"'),o.B.isValidAddressType(i)||(t.addressType='Invalid address type, example: "Shipping" or "Billing"'),o.B.isValidStreet(r)||(t.street='Invalid street, example: "123 Main St"'),o.B.isValidHouse(a)||(t.house='Invalid house, example: "123, 123A, 123/4, 123A/4B"'),o.B.isValidPostalCode(s,u)||(t.postalCode='Invalid postal code, example: "12345, 12345-6789, 101000"')),t}}},161:(t,e,s)=>{s.d(e,{S:()=>i});var n=s(185);class i{constructor(t){const e={tag:"div",classNames:["error__massage"],textContent:t};this.errorMessageElement=new n.Y(e)}showError(t){this.errorMessageElement&&t.after(this.errorMessageElement.getElement())}hideError(){this.errorMessageElement&&(this.errorMessageElement.getElement().remove(),this.errorMessageElement=null)}}},403:(t,e,s)=>{s.d(e,{B:()=>n});class n{static isValidPostalCode(t,e){switch(t){case"US":return/^\d{5}(?:[-\s]\d{4})?$/.test(e);case"RU":return/^\d{6}$/.test(e);default:return!1}}static isValidCountry(t){return"US"===t||"RU"===t}static isValidAddressType(t){return"Shipping"===t||"Billing"===t}static isValidBirthdate(t,e=13){const s=new Date(t),n=new Date,i=n.getFullYear()-s.getFullYear(),r=n.getMonth()-s.getMonth(),a=n.getDate()-s.getDate();return r<0||0===r&&a<0?i-1>=e:i>=e}static isValidCity(t){return/^[a-zA-Z\s]+$/.test(t)}static isValidStreet(t){return t.length>0}static isValidSurname(t){return/^[a-zA-Z\s]+$/.test(t)&&/[a-zA-Z]/.test(t)}static isValidName(t){return/^[a-zA-Z\s]+$/.test(t)&&/[a-zA-Z]/.test(t)}static isValidEmail(t){return t===t.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}static isValidPassword(t){const e=/[A-Z]/.test(t),s=/[a-z]/.test(t),n=/\d/.test(t),i=/^\S+$/.test(t),r=/[!@#$%^&*]/.test(t);return t.length>=8&&e&&s&&n&&i&&r}static isValidHouse(t){return/^\d+[a-zA-Z]*\/?\d*[a-zA-Z]*$/.test(t)}}},848:(t,e,s)=>{s.d(e,{$:()=>i});var n=s(940);class i extends n.S{constructor(t){super({tag:"button",classNames:["button"]}),this.setupInput(t)}setupInput(t){const e=this.getElement();e.textContent=t.label,t.disabled&&(e.disabled=t.disabled)}}},861:(t,e,s)=>{s.d(e,{$:()=>o});var n=s(940);class i extends n.S{constructor(){super({tag:"button",classNames:["error__close"],textContent:"close"})}}class r extends n.S{constructor(){super({tag:"p",classNames:["error__text"]})}}class a extends n.S{constructor(){super({tag:"div",classNames:["modal-error"]})}}class o extends n.S{constructor(){super({tag:"div",classNames:["overlay","hidden"]}),this.errorMessage=new r,this.errorWrapper=new a,this.errorButton=new i,this.setupErrorAuth(),this.setupEvent()}showMessage(t,e){this.errorMessage.getElement().textContent=` [ ${e} ]: ${t}`,this.getElement().classList.remove("hidden")}hideMessage(){this.getElement().classList.add("hidden")}setupEvent(){this.errorButton.getElement().addEventListener("click",(()=>this.hideMessage()))}setupErrorAuth(){this.errorWrapper.getElement().append(this.errorMessage.getElement(),this.errorButton.getElement()),this.addInnerElement(this.errorWrapper.getElement())}}}}]);