(()=>{"use strict";var t,e,n={614:(t,e,n)=>{n.d(e,{R:()=>r});class r{static create(t=r.randomHexColor(),e="70",n="70"){return`\n        <svg class="car__svg" xmlns="http://www.w3.org/2000/svg" width=${e} height=${n} fill=${t} viewBox="0 0 256 256" xml:space="preserve">\n            <path d="M212.435 174.994c-13.098 0-23.753-10.655-23.753-23.753s10.655-23.753 23.753-23.753 23.753 10.656 23.753 23.753-10.656 23.753-23.753 23.753zm0-39.076c-8.45 0-15.323 6.874-15.323 15.323s6.873 15.323 15.323 15.323 15.323-6.873 15.323-15.323-6.876-15.323-15.323-15.323zM51.478 174.994c-13.097 0-23.753-10.655-23.753-23.753s10.656-23.753 23.753-23.753 23.753 10.656 23.753 23.753-10.656 23.753-23.753 23.753zm0-39.076c-8.447 0-15.323 6.874-15.323 15.323s6.873 15.323 15.323 15.323 15.323-6.873 15.323-15.323-6.873-15.323-15.323-15.323z"/>\n            <path d="M212.438 159.663a8.459 8.459 0 0 1-5.958-2.473 7.806 7.806 0 0 1-1.067-1.262 9.018 9.018 0 0 1-.76-1.464 6.231 6.231 0 0 1-.477-1.573 8.33 8.33 0 0 1-.171-1.66c0-.532.059-1.097.171-1.628.082-.562.253-1.07.478-1.602.194-.505.478-.986.759-1.433.309-.477.674-.899 1.067-1.292.366-.396.815-.734 1.265-1.04.478-.309.955-.562 1.464-.787a10.073 10.073 0 0 1 1.574-.477 8.236 8.236 0 0 1 3.315 0c.534.112 1.04.28 1.577.477.506.225.983.478 1.433.787.478.306.899.644 1.292 1.04.394.393.731.815 1.04 1.292.31.447.562.928.787 1.433.194.532.365 1.04.478 1.602.112.531.168 1.096.168 1.627 0 .562-.056 1.099-.168 1.66a10.581 10.581 0 0 1-.478 1.574c-.225.506-.478.984-.787 1.464-.309.447-.646.897-1.04 1.262a7.64 7.64 0 0 1-1.292 1.068c-.45.284-.927.562-1.433.761-.534.225-1.04.394-1.577.478a8.553 8.553 0 0 1-1.66.166zM51.48 159.663a8.299 8.299 0 0 1-1.657-.169c-.534-.112-1.068-.253-1.574-.477-.506-.197-.983-.478-1.46-.762a8.718 8.718 0 0 1-1.265-1.068 8.47 8.47 0 0 1-2.473-5.957c0-.53.056-1.096.168-1.627.113-.534.253-1.07.478-1.576.197-.531.478-1.012.759-1.461.309-.478.674-.9 1.068-1.293a8.515 8.515 0 0 1 1.264-1.04c.478-.309.955-.562 1.461-.787.506-.196 1.04-.365 1.574-.477a8.098 8.098 0 0 1 3.288 0c.562.112 1.067.28 1.601.477.506.225.984.478 1.433.787.478.307.9.644 1.293 1.04.393.393.73.815 1.04 1.293.309.446.562.927.786 1.46.197.507.366 1.04.478 1.577.113.531.169 1.096.169 1.627 0 2.22-.9 4.412-2.473 5.957a7.64 7.64 0 0 1-1.293 1.068c-.45.284-.927.562-1.433.762-.506.224-1.04.365-1.601.477a7.83 7.83 0 0 1-1.63.169z"/>\n            <path d="m225.53 116.243-41.322-10.597-19.695-11.428a100.079 100.079 0 0 0-50.164-13.502H84.625c-19.176 0-37.494 7.168-51.578 20.184a10.864 10.864 0 0 1-7.401 2.895h-6.29c-7.637 0-14.086 5.718-15.002 13.302l-2.846 23.64a13.903 13.903 0 0 0 9.09 14.787l12.923 4.693a29.276 29.276 0 0 1-1.416-8.978c0-16.197 13.176-29.373 29.373-29.373s29.373 13.176 29.373 29.373c0 4.442-1.02 8.64-2.793 12.42h107.797c-1.773-3.78-2.793-7.978-2.793-12.42 0-16.197 13.176-29.373 29.373-29.373s29.373 13.176 29.373 29.373c0 3.875-.773 7.567-2.142 10.956l8.192-1.31a7.621 7.621 0 0 0 6.449-7.559c0-17.486-11.836-32.736-28.778-37.083zM77.1 111.457c-3.673 0-7.003-1.714-9.136-4.7-2.135-2.988-2.678-6.694-1.486-10.167l1.843-5.384c5.291-1.313 10.748-2.057 16.307-2.057h6.46l9.458 22.308H77.1zm82.673 0H109.7l-9.458-22.308h14.106a91.628 91.628 0 0 1 45.932 12.361l12.876 7.469c-4.288 1.613-8.77 2.478-13.384 2.478z"/>\n        </svg>\n        `}static randomHexColor(){const t=Math.floor(256*Math.random()),e=Math.floor(256*Math.random()),n=Math.floor(256*Math.random());return`#${t.toString(16).padStart(2,"0")}${e.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}`}}},256:(t,e,n)=>{n.d(e,{S:()=>i});class r{constructor(t){this.element=document.createElement(t.tag),t.classNames&&this.setCssSelector(t.classNames),t.textContent&&this.setTextContent(t.textContent),t.callback&&this.setCallback(t.callback)}getElement(){return this.element}addInnerElement(t){t instanceof r?this.element.append(t.getElement()):this.element.append(t)}setCssSelector(t){t.forEach((t=>{this.element.classList.add(t)}))}setTextContent(t){this.element.textContent=t}setCallback(t){this.element.addEventListener("click",t)}}class i{constructor(t){this.viewHtmlElement=this.createElement(t)}createElement(t){return new r(t)}getElement(){return this.viewHtmlElement.getElement()}addInnerElement(t){this.viewHtmlElement.addInnerElement(t)}render(t){console.log(t)}}}},r={};function i(t){var e=r[t];if(void 0!==e)return e.exports;var o=r[t]={exports:{}};return n[t](o,o.exports,i),o.exports}i.m=n,i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.f={},i.e=t=>Promise.all(Object.keys(i.f).reduce(((e,n)=>(i.f[n](t,e),e)),[])),i.u=t=>t+"."+{208:"5854eb794aa6d0ffdb50",294:"03a3d2888f2621004a95"}[t]+".js",i.miniCssF=t=>"css/"+t+"."+{208:"a3e7dca7",294:"acf420b5"}[t]+".css",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="async-race:",i.l=(n,r,o,s)=>{if(t[n])t[n].push(r);else{var a,c;if(void 0!==o)for(var l=document.getElementsByTagName("script"),h=0;h<l.length;h++){var d=l[h];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==e+o){a=d;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.setAttribute("data-webpack",e+o),a.src=n),t[n]=[r];var u=(e,r)=>{a.onerror=a.onload=null,clearTimeout(g);var i=t[n];if(delete t[n],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((t=>t(r))),e)return e(r)},g=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),c&&document.head.appendChild(a)}},i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!t||!/^http(s?):/.test(t));)t=n[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),(()=>{if("undefined"!=typeof document){var t={792:0};i.f.miniCss=(e,n)=>{t[e]?n.push(t[e]):0!==t[e]&&{208:1,294:1}[e]&&n.push(t[e]=(t=>new Promise(((e,n)=>{var r=i.miniCssF(t),o=i.p+r;if(((t,e)=>{for(var n=document.getElementsByTagName("link"),r=0;r<n.length;r++){var i=(s=n[r]).getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(i===t||i===e))return s}var o=document.getElementsByTagName("style");for(r=0;r<o.length;r++){var s;if((i=(s=o[r]).getAttribute("data-href"))===t||i===e)return s}})(r,o))return e();((t,e,n,r,o)=>{var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",i.nc&&(s.nonce=i.nc),s.onerror=s.onload=n=>{if(s.onerror=s.onload=null,"load"===n.type)r();else{var i=n&&n.type,a=n&&n.target&&n.target.href||e,c=new Error("Loading CSS chunk "+t+" failed.\n("+i+": "+a+")");c.name="ChunkLoadError",c.code="CSS_CHUNK_LOAD_FAILED",c.type=i,c.request=a,s.parentNode&&s.parentNode.removeChild(s),o(c)}},s.href=e,document.head.appendChild(s)})(t,o,0,e,n)})))(e).then((()=>{t[e]=0}),(n=>{throw delete t[e],n})))}}})(),(()=>{var t={792:0};i.f.j=(e,n)=>{var r=i.o(t,e)?t[e]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise(((n,i)=>r=t[e]=[n,i]));n.push(r[2]=o);var s=i.p+i.u(e),a=new Error;i.l(s,(n=>{if(i.o(t,e)&&(0!==(r=t[e])&&(t[e]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;a.message="Loading chunk "+e+" failed.\n("+o+": "+s+")",a.name="ChunkLoadError",a.type=o,a.request=s,r[1](a)}}),"chunk-"+e,e)}};var e=(e,n)=>{var r,o,[s,a,c]=n,l=0;if(s.some((e=>0!==t[e]))){for(r in a)i.o(a,r)&&(i.m[r]=a[r]);c&&c(i)}for(e&&e(n);l<s.length;l++)o=s[l],i.o(t,o)&&t[o]&&t[o][0](),t[o]=0},n=self.webpackChunkasync_race=self.webpackChunkasync_race||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),(()=>{var t=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))};class e{static get(n,r){return t(this,void 0,void 0,(function*(){const t=new URL(`${e.API_URL}/${n}`);r&&Object.entries(r).forEach((([e,n])=>{t.searchParams.append(`_${e}`,String(n))}));try{const e=yield fetch(t);if(!e.ok)throw new Error(e.statusText);const n=e.headers.get("X-Total-Count");return n?{data:yield e.json(),totalCount:n}:{data:yield e.json()}}catch(e){throw e instanceof Error&&console.error(e.message),new Error(`[GET] failed to fetch ${t}`)}}))}static post(n,r){return t(this,void 0,void 0,(function*(){try{const t=yield fetch(`${e.API_URL}/${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!t.ok)throw new Error(t.statusText);return yield t.json()}catch(t){throw t instanceof Error&&console.error(t.message),new Error(`[POST] failed to fetch ${e.API_URL}/${n}`)}}))}static put(n,r){return t(this,void 0,void 0,(function*(){try{const t=yield fetch(`${e.API_URL}/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!t.ok)throw new Error(t.statusText);return yield t.json()}catch(t){throw t instanceof Error&&console.error(t.message),new Error(`[PUT] failed to fetch ${e.API_URL}/${n}`)}}))}static patch(n,r){return t(this,void 0,void 0,(function*(){const t=new URL(`${e.API_URL}/${n}`);Object.entries(r).forEach((([e,n])=>{t.searchParams.append(`${e}`,String(n))}));try{const e=yield fetch(`${t}`,{method:"PATCH",body:JSON.stringify(r)});if(!e.ok){if(429===e.status)throw new Error(e.statusText);if(500===e.status)throw new Error(e.statusText);throw new Error(e.statusText)}return yield e.json()}catch(t){throw t instanceof Error&&console.error(t.message),new Error(`[PATCH] failed to fetch ${e.API_URL}/${n}`)}}))}static delete(n){return t(this,void 0,void 0,(function*(){try{const t=yield fetch(`${e.API_URL}/${n}`,{method:"DELETE"});if(!t.ok)throw new Error(t.statusText);return yield t.json()}catch(t){throw t instanceof Error&&console.error(t.message),new Error(`[DELETE] failed to fetch ${e.API_URL}/${n}`)}}))}}e.API_URL="http://127.0.0.1:3000";var n=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))};class r{static getCars(t,r){return n(this,void 0,void 0,(function*(){const n={};return t&&r&&(n.page=t,n.limit=r),e.get("garage",n)}))}static getCar(t){return n(this,void 0,void 0,(function*(){return e.get(`garage/${t}`)}))}static createCar(t){return n(this,void 0,void 0,(function*(){return e.post("garage",t)}))}static deleteCar(t){return n(this,void 0,void 0,(function*(){return e.delete(`garage/${t}`)}))}static updateCar(t){return n(this,void 0,void 0,(function*(){return e.put(`garage/${t.id}`,t)}))}}var o=i(614),s=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))};class a{static startAndStop(t,n){return s(this,void 0,void 0,(function*(){return e.patch("engine",{id:t,status:n})}))}static switchEngineToDrive(t,n){return s(this,void 0,void 0,(function*(){return e.patch("engine",{id:t,status:n})}))}}var c=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))};class l{constructor(t){this.garageController=t}startEngine(t){return c(this,void 0,void 0,(function*(){try{const{distance:e,velocity:n}=yield a.startAndStop(t,"started");return{distance:e,velocity:n}}catch(t){throw t instanceof Error&&console.error(t.message),new Error("[EngineController - stopEngine] failed to fetch")}}))}stopEngine(t){return c(this,void 0,void 0,(function*(){try{const{distance:e,velocity:n}=yield a.startAndStop(t,"stopped");return{distance:e,velocity:n}}catch(t){throw t instanceof Error&&console.error(t.message),new Error("[EngineController - stopEngine] failed to fetch")}}))}driveEngine(t){return c(this,void 0,void 0,(function*(){try{const{success:e}=yield a.switchEngineToDrive(t,"drive");return{success:e}}catch(t){throw t instanceof Error&&console.error(t.message),new Error("[EngineController - driveEngine] failed to fetch")}}))}}var h=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))};class d{constructor(t,e){this.animations=new Map,this.finishedCar=new Map,this.engineController=t,this.winnerController=e}addCustomAnimation(t,e){this.animations.set(t,e)}clearCustomAnimation(){this.animations.clear()}showMessageView(t){const e=[...this.animations].filter((([e])=>+e.getElement().id===t.carId)).map((([e])=>{var n;return{nameCar:null===(n=e.getElement().querySelector(".car__title"))||void 0===n?void 0:n.textContent,time:t.time}}))[0],n=document.createElement("span");n.classList.add("modal__winner"),n.textContent=`${e.nameCar} won the race in ${t.time.toFixed(2)} s.`,document.body.append(n),setTimeout((()=>n.remove()),6e3)}updateOrCreateWinnersTable(t){return h(this,void 0,void 0,(function*(){let e=null;try{const{data:n}=yield this.winnerController.getWinner(t.carId);if(e=n,n){const e=Object.assign(Object.assign({},n),{wins:(n.wins||0)+1,time:+Math.min(t.time,+n.time).toFixed(2)});yield this.winnerController.updateWinner(e)}}catch(t){this.handleError(t)}if(!e)try{const e={id:t.carId,wins:1,time:+t.time.toFixed(2)};yield this.winnerController.addWinner(e)}catch(t){this.handleError(t)}}))}showResultRaceAndUpdateWinnersTable(){return h(this,void 0,void 0,(function*(){const t=[];[...this.finishedCar].forEach((([e,n])=>{const r={carId:e,time:(n.endTime?n.endTime-n.startTime:0)/1e3};t.push(r)})),t.sort(((t,e)=>t.time-e.time));try{yield this.updateOrCreateWinnersTable(t[0])}catch(t){this.handleError(t)}this.showMessageView(t[0])}))}resetRace(){return h(this,void 0,void 0,(function*(){try{const t=[];this.animations.forEach(((e,n)=>{const r=parseInt(n.getElement().id||"",10),i=this.engineController.stopEngine(r);i.then((()=>{e.reset()})).catch((t=>{this.handleError(t)})),t.push(i)})),yield Promise.allSettled(t)}catch(t){this.handleError(t)}}))}startRace(){return h(this,void 0,void 0,(function*(){this.finishedCar.clear();try{const t=[];this.animations.forEach(((e,n)=>{const r=parseInt(n.getElement().id||"",10),i={carId:r,startTime:Date.now()};this.finishedCar.set(r,i);const o=this.engineController.startEngine(r);o.then((({distance:t,velocity:r})=>{const i=n.getElement(),o=i.querySelector(".car__image"),s=i.querySelector(".car__svg");e.setCustomAnimation(o,s,t,r).start()})).catch((t=>{this.handleError(t)})),t.push(o)})),yield Promise.allSettled(t);try{yield this.driveRace()}catch(t){this.handleError(t)}}catch(t){this.handleError(t)}finally{this.showResultRaceAndUpdateWinnersTable().catch((t=>this.handleError(t)))}}))}driveRace(){return h(this,void 0,void 0,(function*(){try{const t=[];this.animations.forEach(((e,n)=>{const r=parseInt(n.getElement().id||"",10),i=this.engineController.driveEngine(r);i.then((()=>{const t=this.finishedCar.get(r);t&&(t.endTime=Date.now())})).catch((t=>{this.handleError(t),e.stop(),this.finishedCar.delete(r)})),t.push(i)})),yield Promise.allSettled(t)}catch(t){this.handleError(t)}}))}handleError(t){t instanceof Error&&console.error(t.message)}}var u=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))};const g=["Toyota","Honda","BMW","Ford","Chevrolet","Mercedes","Audi","Volkswagen","Tesla","Lexus"],f=["Model S","CIVIC","7","Mustang","GX","GLS","Q7","Golf","Camry","IS"];class v{constructor(t,e){this.generateRandomCount=100,this.state=t,this.engineController=new l(this),this.raceController=new d(this.engineController,e),this.winnerController=e,this.loadCars()}loadCars(){return u(this,void 0,void 0,(function*(){try{const t=this.state.getCurrentPage(),e=this.state.getLimit(),{data:n,totalCount:i}=yield r.getCars(t,e);this.state.setCars(n),this.state.setTotalCarsCount(parseInt(i||"",10))}catch(t){t instanceof Error&&console.error(t.message)}}))}addCar(t,e){return u(this,void 0,void 0,(function*(){try{const n={name:t,color:e};yield r.createCar(n),yield this.loadCars()}catch(t){t instanceof Error&&console.error(t.message)}}))}removeCar(t){return u(this,void 0,void 0,(function*(){try{const e=this.winnerController.getCars().find((e=>e.id===t));e&&(yield this.winnerController.removeWinner(e.id)),yield r.deleteCar(t),yield this.loadCars()}catch(t){t instanceof Error&&console.error(t.message)}}))}updateCar(t){return u(this,void 0,void 0,(function*(){const e=this.winnerController.getCars().find((e=>e.id===t.id));try{yield r.updateCar(t),yield this.loadCars(),e&&(yield this.winnerController.setCars())}catch(t){t instanceof Error&&console.error(t.message)}}))}getCar(t){return u(this,void 0,void 0,(function*(){try{return yield r.getCar(t)}catch(t){throw t instanceof Error&&console.error(t.message),new Error("[GarageController - getCar] failed to fetch")}}))}getCars(){return this.state.getCars()}getPageAndTotalCount(){return{page:this.state.getCurrentPage(),totalCarsCount:this.state.getTotalCarsCount()}}nextPage(){return u(this,void 0,void 0,(function*(){try{this.state.nextPage(),yield this.loadCars()}catch(t){t instanceof Error&&console.error(t.message)}}))}prevPage(){return u(this,void 0,void 0,(function*(){try{this.state.prevPage(),yield this.loadCars()}catch(t){t instanceof Error&&console.error(t.message)}}))}generateRandomCars(){return u(this,void 0,void 0,(function*(){try{const t=[];for(let e=0;e<this.generateRandomCount;e+=1){const e=o.R.randomHexColor(),n={name:`${g[Math.floor(Math.random()*g.length)]} ${f[Math.floor(Math.random()*f.length)]}`,color:e};t.push(r.createCar(n))}yield Promise.all(t),yield this.loadCars()}catch(t){t instanceof Error&&console.error(t.message)}}))}}var m=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))};class p{static getWinners(t,n,r,i){return m(this,void 0,void 0,(function*(){const o={};return t&&n&&(o.page=t,o.limit=n),r&&i&&(o.sort=r,o.order=i),e.get("winners",o)}))}static getWinner(t){return m(this,void 0,void 0,(function*(){return e.get(`winners/${t}`)}))}static createWinner(t){return m(this,void 0,void 0,(function*(){return e.post("winners",t)}))}static deleteWinner(t){return m(this,void 0,void 0,(function*(){return e.delete(`winners/${t}`)}))}static updateWinner(t){return m(this,void 0,void 0,(function*(){return e.put(`winners/${t.id}`,t)}))}}var y=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))};class C{constructor(t){this.state=t,this.loadWinners()}setCars(){return y(this,void 0,void 0,(function*(){try{const t=this.state.getWinners(),e=[],n=t.map((t=>y(this,void 0,void 0,(function*(){return yield r.getCar(t.id)}))));(yield Promise.all(n)).forEach((({data:t})=>{const n={id:t.id,name:t.name,color:t.color};e.push(n)})),this.state.setCars(e)}catch(t){t instanceof Error&&console.error(t.message)}}))}loadWinners(){return y(this,void 0,void 0,(function*(){try{const t=this.state.getCurrentPage(),e=this.state.getLimit(),n=this.state.getSortBy(),r=this.state.getSortOrder(),{data:i,totalCount:o}=yield p.getWinners(t,e,n,r);this.state.setWinners(i),this.state.setTotalWinnersCount(parseInt(o||"",10)),yield this.setCars()}catch(t){t instanceof Error&&console.error(t.message)}}))}addWinner(t){return y(this,void 0,void 0,(function*(){try{yield p.createWinner(t),yield this.loadWinners()}catch(t){t instanceof Error&&console.error(t.message)}}))}removeWinner(t){return y(this,void 0,void 0,(function*(){try{yield p.deleteWinner(t),yield this.loadWinners()}catch(t){t instanceof Error&&console.error(t.message)}}))}updateWinner(t){return y(this,void 0,void 0,(function*(){try{yield p.updateWinner(t),yield this.loadWinners()}catch(t){t instanceof Error&&console.error(t.message)}}))}getWinner(t){return y(this,void 0,void 0,(function*(){try{return yield p.getWinner(t)}catch(t){throw t instanceof Error&&console.error(t.message),new Error("[WinnerController - getWinner] failed to fetch")}}))}getWinners(){return this.state.getWinners()}getCars(){return this.state.getCars()}getPageAndTotalCount(){return{page:this.state.getCurrentPage(),totalWinnersCount:this.state.getTotalWinnersCount()}}nextPage(){return y(this,void 0,void 0,(function*(){try{this.state.nextPage(),yield this.loadWinners()}catch(t){t instanceof Error&&console.error(t.message)}}))}prevPage(){return y(this,void 0,void 0,(function*(){try{this.state.prevPage(),yield this.loadWinners()}catch(t){t instanceof Error&&console.error(t.message)}}))}setSortBy(t){this.state.setSortBy(t)}handleSortBy(t){return y(this,void 0,void 0,(function*(){this.setSortBy(t),this.state.toggleSortOrder(),yield this.loadWinners()}))}}class w{constructor({path:t,callback:e}){this.path=t,this.callback=e}}class E{constructor(t,e){this.routes=[],this.app=t,this.controllers=e}addRoute({path:t,callback:e}){this.routes.push(new w({path:t,callback:e}))}navigate(t){return e=this,n=void 0,i=function*(){const e=this.routes.find((e=>e.path===t));e?yield e.callback(this.app,this.controllers):console.error(`not found route: ${t}`)},new((r=void 0)||(r=Promise))((function(t,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(t){t(n)}))).then(s,a)}c((i=i.apply(e,n||[])).next())}));var e,n,r,i}}var b=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))};const P=[{path:"./garage",callback:(t,e)=>b(void 0,void 0,void 0,(function*(){const{GarageView:n}=yield i.e(208).then(i.bind(i,95));t.renderPageView(new n(e.garageController))}))},{path:"./winners",callback:(t,e)=>b(void 0,void 0,void 0,(function*(){const{WinnerView:n}=yield i.e(294).then(i.bind(i,294));t.renderPageView(new n(e.winnerController))}))}];class S{constructor(){this.cars=[],this.page=1,this.limit=7,this.totalCarsCount=0}getCurrentPage(){return this.page}getLimit(){return this.limit}getTotalCarsCount(){return this.totalCarsCount}setTotalCarsCount(t){this.totalCarsCount=t}getCars(){return this.cars}setCars(t){this.cars=[],this.cars.push(...t)}nextPage(){const t=this.page+1;t<=Math.ceil(this.totalCarsCount/this.limit)&&(this.page=t)}prevPage(){this.page>1&&(this.page-=1)}}class x{constructor(){this.winners=[],this.cars=[],this.page=1,this.limit=10,this.sortBy="id",this.sortOrder="ASC",this.totalWinnersCount=0}getCurrentPage(){return this.page}getLimit(){return this.limit}getTotalWinnersCount(){return this.totalWinnersCount}getSortBy(){return this.sortBy}setSortBy(t){this.sortBy=t}getSortOrder(){return this.sortOrder}setTotalWinnersCount(t){this.totalWinnersCount=t}getWinners(){return this.winners}setWinners(t){this.winners=[],this.winners.push(...t)}getCars(){return this.cars}setCars(t){this.cars=[],this.cars.push(...t)}nextPage(){const t=this.page+1;t<=Math.ceil(this.totalWinnersCount/this.limit)&&(this.page=t)}prevPage(){this.page>1&&(this.page-=1)}toggleSortOrder(){"ASC"===this.sortOrder?this.sortOrder="DESC":this.sortOrder="ASC"}}var T=i(256);class W extends T.S{constructor(t,e,n){super({tag:"li",classNames:[...(n?"nav__link active":"nav__link").split(" ")],textContent:t}),this.setupLinkView(e)}setupLinkView(t){this.getElement().id=t}}class k extends T.S{constructor(t){super({tag:"ul",classNames:["nav__list"]}),this.router=t,this.onHandleClick=this.onHandleClick.bind(this),this.setupNavigateView(),this.setupEventListener()}updateClassActiveLink(){[...this.getElement().children].forEach((t=>{t.classList.remove("active")}))}onHandleClick(t){const e=t.target;"garage"===e.id&&(this.updateClassActiveLink(),e.classList.add("active"),this.router.navigate("./garage")),"winners"===e.id&&(this.updateClassActiveLink(),e.classList.add("active"),this.router.navigate("./winners"))}setupEventListener(){this.getElement().addEventListener("click",this.onHandleClick)}setupNavigateView(){const t=new W("garage","garage","active").getElement(),e=new W("winners","winners").getElement();this.getElement().append(t,e)}}class $ extends T.S{constructor(t){super({tag:"header",classNames:["header"]}),this.setupHeader(t)}setupHeader(t){const e=new k(t).getElement();this.viewHtmlElement.addInnerElement(e)}}class L extends T.S{constructor(){super({tag:"main",classNames:["main"]})}render(t){this.clearContent(),this.addInnerElement(t.getElement())}clearContent(){this.getElement().innerHTML=""}}(new class{constructor(){this.garageState=new S,this.winnerState=new x,this.winnerController=new C(this.winnerState),this.garageController=new v(this.garageState,this.winnerController);const t={garageController:this.garageController,winnerController:this.winnerController};this.router=new E(this,t),this.header=new $(this.router),this.pageView=new L,this.setupRouter()}setupRouter(){P.forEach((({path:t,callback:e})=>{this.router.addRoute({path:t,callback:e})})),this.router.navigate("./garage")}renderPageView(t){t&&this.pageView.render(t)}render(){const t=document.querySelector("body");t&&t.append(this.header.getElement(),this.pageView.getElement())}}).render()})()})();