"use strict";(self.webpackChunkasync_race=self.webpackChunkasync_race||[]).push([[208],{95:(t,e,n)=>{n.r(e),n.d(e,{GarageView:()=>T});var s=n(256);class i extends s.S{constructor(t){super({tag:"button",classNames:["race__button"]}),this.controller=t,this.onClickRace=this.onClickRace.bind(this),this.setupButton(),this.setupEventListener()}setupEventListener(){this.getElement().addEventListener("click",this.onClickRace)}enableBtnStartAndStop(){const t=document.querySelectorAll(".button__start"),e=document.querySelectorAll(".button__stop"),n=document.querySelector(".reset__button");n&&(n.disabled=!1),null==t||t.forEach(((n,s)=>{t[s].disabled=!0,e[s].disabled=!1}))}onClickRace(t){return e=this,n=void 0,i=function*(){t.target.disabled=!0;const{raceController:e}=this.controller;this.enableBtnStartAndStop();try{yield e.startRace()}catch(t){t instanceof Error&&console.log(t.message)}},new((s=void 0)||(s=Promise))((function(t,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof s?n:new s((function(t){t(n)}))).then(o,a)}l((i=i.apply(e,n||[])).next())}));var e,n,s,i}setupButton(){this.getElement().textContent="race"}}class r extends s.S{constructor(t){super({tag:"button",classNames:["reset__button"]}),this.controller=t,this.onClickReset=this.onClickReset.bind(this),this.setupButton(),this.setupEventListener()}setupEventListener(){this.getElement().addEventListener("click",this.onClickReset)}enableBtnStartAndStop(){const t=document.querySelectorAll(".button__start"),e=document.querySelectorAll(".button__stop"),n=document.querySelector(".race__button");n&&(n.disabled=!1),null==t||t.forEach(((n,s)=>{t[s].disabled=!1,e[s].disabled=!0}))}onClickReset(t){return e=this,n=void 0,i=function*(){t.target.disabled=!0;const{raceController:e}=this.controller;this.enableBtnStartAndStop();try{yield e.resetRace()}catch(t){t instanceof Error&&console.error(t.message)}},new((s=void 0)||(s=Promise))((function(t,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof s?n:new s((function(t){t(n)}))).then(o,a)}l((i=i.apply(e,n||[])).next())}));var e,n,s,i}setupButton(){this.getElement().textContent="reset",this.getElement().disabled=!0}}class o extends s.S{constructor(t,e){super({tag:"button",classNames:["generate__button"]}),this.controller=t,this.garageView=e,this.onClickGenerate=this.onClickGenerate.bind(this),this.setupButton(),this.setupEventListener()}setupEventListener(){this.getElement().addEventListener("click",this.onClickGenerate)}onClickGenerate(){return t=this,e=void 0,s=function*(){const{raceController:t}=this.controller;t.clearCustomAnimation();try{yield this.controller.generateRandomCars(),this.garageView.updateTitleAndCarList()}catch(t){t instanceof Error&&console.error(t.message)}},new((n=void 0)||(n=Promise))((function(i,r){function o(t){try{l(s.next(t))}catch(t){r(t)}}function a(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}));var t,e,n,s}setupButton(){this.getElement().textContent="generate (100+)"}}class a extends s.S{constructor(t,e){super({tag:"section",classNames:["control__panel"]}),this.raceButton=null,this.resetButton=null,this.generateButton=null,this.controller=t,this.garageView=e,this.setupControlPanel()}setupControlPanel(){this.raceButton=new i(this.controller),this.resetButton=new r(this.controller),this.generateButton=new o(this.controller,this.garageView),this.getElement().append(this.raceButton.getElement(),this.resetButton.getElement(),this.generateButton.getElement())}}class l extends s.S{constructor(t){super({tag:"input",classNames:["form__input"]}),this.setupInput(t)}setupInput(t){this.getElement().setAttribute("type",t)}}class c extends s.S{constructor(t,e){super({tag:"input",classNames:["form__input-color"]}),this.setupInput(t,e)}setupInput(t,e){this.getElement().setAttribute("type",t),this.getElement().setAttribute("value",`${e}`)}}class u extends s.S{constructor(t){super({tag:"button",classNames:["form__btn"],textContent:`${t}`})}}class h extends s.S{constructor(t,e,n){super({tag:"form",classNames:["form__add"]}),this.inputText=null,this.inputColor=null,this.buttonAdd=null,this.addCarCallback=t,this.updateTitleAndCarList=e,this.garageController=n,this.onSubmitForm=this.onSubmitForm.bind(this),this.setupForm(),this.setupEventListener()}onSubmitForm(t){return e=this,n=void 0,i=function*(){t.preventDefault();const{raceController:e}=this.garageController;if(e.clearCustomAnimation(),this.inputText&&this.inputColor){const t=this.inputText.getElement().value,e=this.inputColor.getElement().value;if(t&&e)try{yield this.addCarCallback(t,e),this.inputText.getElement().value="",this.updateTitleAndCarList()}catch(t){t instanceof Error&&console.error(t.message)}}},new((s=void 0)||(s=Promise))((function(t,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof s?n:new s((function(t){t(n)}))).then(o,a)}l((i=i.apply(e,n||[])).next())}));var e,n,s,i}setupEventListener(){this.getElement().addEventListener("submit",this.onSubmitForm)}setupForm(){this.inputText=new l("text"),this.inputColor=new c("color","#F5B7B1"),this.buttonAdd=new u("create"),this.getElement().append(this.inputText.getElement(),this.inputColor.getElement(),this.buttonAdd.getElement())}}class d extends s.S{constructor(t,e){super({tag:"form",classNames:["form__update"]}),this.controller=t,this.garageView=e,this.inputText=new l("text"),this.inputColor=new c("color","#A8E4A0"),this.buttonUpdate=new u("update"),this.onSubmitForm=this.onSubmitForm.bind(this),this.setupForm(),this.setupEventListener()}setupEventListener(){this.getElement().addEventListener("submit",this.onSubmitForm)}clearForm(){const t=this.inputText.getElement(),e=this.buttonUpdate.getElement();t.value="",e.disabled=!0}onSubmitForm(t){return e=this,n=void 0,i=function*(){t.preventDefault();const{raceController:e}=this.controller;e.clearCustomAnimation();const n=this.inputText.getElement().value,s=this.inputText.getElement().getAttribute("data-car-id"),i=parseInt(s||"",10),r=this.inputColor.getElement().value;if(n&&i&&r)try{yield this.controller.updateCar({id:i,name:n,color:r}),this.garageView.updateTitleAndCarList(),this.clearForm()}catch(t){t instanceof Error&&console.error(t.message)}},new((s=void 0)||(s=Promise))((function(t,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof s?n:new s((function(t){t(n)}))).then(o,a)}l((i=i.apply(e,n||[])).next())}));var e,n,s,i}setupForm(){this.buttonUpdate.getElement().disabled=!0,this.getElement().append(this.inputText.getElement(),this.inputColor.getElement(),this.buttonUpdate.getElement())}}class m extends s.S{constructor(t=1){super({tag:"h2",classNames:["garage__subtitle"]}),this.setupSubTitle(t)}setupSubTitle(t){this.getElement().textContent="page ";const e=document.createElement("span");e.classList.add("subtitle__count"),e.textContent=`# ${t}`,this.addInnerElement(e)}}class g extends s.S{constructor(t=0){super({tag:"h1",classNames:["garage__title"]}),this.setupTitle(t)}setupTitle(t){this.getElement().textContent="garage ";const e=document.createElement("span");e.classList.add("title__count"),e.textContent=`(${t})`,this.addInnerElement(e)}}class p extends s.S{constructor(t,e,n,s){super({tag:"button",classNames:["button__remove"]}),this.updateTitleAndCarList=t,this.removeCallback=e,this.onClickDelete=this.onClickDelete.bind(this),this.id=n,this.garageController=s,this.setupButton(),this.setupEventListener()}onClickDelete(){return t=this,e=void 0,s=function*(){const{raceController:t}=this.garageController;t.clearCustomAnimation();try{yield this.removeCallback(this.id),this.updateTitleAndCarList()}catch(t){t instanceof Error&&console.error(t.message)}},new((n=void 0)||(n=Promise))((function(i,r){function o(t){try{l(s.next(t))}catch(t){r(t)}}function a(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}));var t,e,n,s}setupEventListener(){this.getElement().addEventListener("click",this.onClickDelete)}setupButton(){this.getElement().textContent="remove"}}class E extends s.S{constructor(t,e,n){super({tag:"button",classNames:["button__select"]}),this.formUpdate=e,this.id=n,this.selectCallback=t,this.onClickSelect=this.onClickSelect.bind(this),this.setupButton(),this.setupEventListener()}setupEventListener(){this.getElement().addEventListener("click",this.onClickSelect)}setValueInFormUpdate(t,e,n){const s=this.formUpdate.getElement().querySelector(".form__input"),i=this.formUpdate.getElement().querySelector(".form__input-color"),r=this.formUpdate.getElement().querySelector(".form__btn");s&&i&&r&&(s.setAttribute("data-car-id",`${t}`),s.value=e,i.value=n,r.disabled=!1)}enableButton(){const t=document.querySelectorAll(".button__remove");t.forEach(((e,n)=>{t[n].disabled=!1}))}onClickSelect(t){return e=this,n=void 0,i=function*(){const e=t.target;this.enableButton(),e.nextSibling.disabled=!0;try{const{data:{id:t,name:e,color:n}}=yield this.selectCallback(this.id);this.setValueInFormUpdate(t,e,n)}catch(t){t instanceof Error&&console.error(t.message)}},new((s=void 0)||(s=Promise))((function(t,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof s?n:new s((function(t){t(n)}))).then(o,a)}l((i=i.apply(e,n||[])).next())}));var e,n,s,i}setupButton(){this.getElement().textContent="select"}}class C extends s.S{constructor(t,e,n){super({tag:"button",classNames:["button__start"]}),this.garageController=t,this.garageView=e,this.animation=n,this.onClickStartEngine=this.onClickStartEngine.bind(this),this.setupButton(),this.setupEventListener()}setupEventListener(){this.getElement().addEventListener("click",this.onClickStartEngine)}enableControlPanel(){const t=document.querySelector(".reset__button"),e=document.querySelector(".race__button");t&&(t.disabled=!1),e&&(e.disabled=!0)}onClickStartEngine(t){return e=this,n=void 0,i=function*(){this.enableControlPanel();const e=t.target,n=parseInt(e.getAttribute("data-id")||"",10),{engineController:s}=this.garageController,i=e.parentElement,r=e.nextSibling,o=null==i?void 0:i.querySelector(".car__image"),a=null==i?void 0:i.querySelector(".car__svg");if(o&&a)try{const{distance:t,velocity:i}=yield s.startEngine(n);e.disabled=!0,r&&(r.disabled=!1),this.animation.setCustomAnimation(o,a,t,i).start();try{yield s.driveEngine(n)}catch(t){t instanceof Error&&console.error(t.message),this.animation.stop()}}catch(t){t instanceof Error&&console.error(t.message)}},new((s=void 0)||(s=Promise))((function(t,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof s?n:new s((function(t){t(n)}))).then(o,a)}l((i=i.apply(e,n||[])).next())}));var e,n,s,i}setupButton(){this.getElement().textContent="a"}}class v extends s.S{constructor(t,e,n){super({tag:"button",classNames:["button__stop"]}),this.garageController=t,this.garageView=e,this.animation=n,this.onClickStopEngine=this.onClickStopEngine.bind(this),this.setupButton(),this.setupEventListener()}setupEventListener(){this.getElement().addEventListener("click",this.onClickStopEngine),this.getElement().disabled=!0}enableControlPanel(){const t=document.querySelector(".reset__button"),e=document.querySelector(".race__button");[...document.querySelectorAll(".button__stop")].every((t=>t.disabled))&&e&&t&&(e.disabled=!1,t.disabled=!0)}onClickStopEngine(t){return e=this,n=void 0,i=function*(){const e=t.target,n=e.previousSibling,s=parseInt(e.getAttribute("data-id")||"",10),{engineController:i}=this.garageController;try{yield i.stopEngine(s),this.animation.reset(),e.disabled=!0,n.disabled=!1,this.enableControlPanel()}catch(t){t instanceof Error&&console.error(t.message)}},new((s=void 0)||(s=Promise))((function(t,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof s?n:new s((function(t){t(n)}))).then(o,a)}l((i=i.apply(e,n||[])).next())}));var e,n,s,i}setupButton(){this.getElement().textContent="b"}}class b extends s.S{constructor(t=" - "){super({tag:"h3",classNames:["car__title"]}),this.setupTitleCar(t)}setupTitleCar(t){this.getElement().textContent=t}}class f extends s.S{constructor(){super({tag:"div",classNames:["car__wrapper"]})}}var S=n(614);const y=n.p+"images/flag..svg";class x extends s.S{constructor(){super({tag:"img",classNames:["car__flag"]}),this.setupFlagItem()}setupFlagItem(){this.getElement().src=y}}class w extends s.S{constructor(t){super({tag:"div",classNames:["car__image"]}),this.color=t||S.R.randomHexColor(),this.setupCarImage()}setupCarImage(){const t=S.R.create(this.color);this.getElement().innerHTML=t;const e=(new x).getElement();this.addInnerElement(e)}}class _{constructor(){this.initialPosition=0,this.parentElement=null,this.carImage=null,this.animationFrameId=null,this.distance=0,this.velocity=0,this.currentPosition=0}setCustomAnimation(t,e,n,s){return this.parentElement=t,this.carImage=e,this.distance=n,this.velocity=s,this}start(){var t;if(!this.parentElement&&!this.carImage)return null;if(!this.distance&&!this.velocity)return null;const e=this.distance/this.velocity,n=performance.now(),s=this.parentElement?this.parentElement.offsetWidth:0,i=null===(t=this.carImage)||void 0===t?void 0:t.getAttribute("width"),r=parseInt(i||"",10),o=s-r,a=t=>{const i=t-n,r=Math.min(i/e,1);this.currentPosition=r*s,this.currentPosition>o&&(this.currentPosition=o,this.stop()),this.carImage&&(this.carImage.style.left=`${this.currentPosition}px`),r<1&&(this.animationFrameId=requestAnimationFrame(a))};return this.animationFrameId=requestAnimationFrame(a),this}stop(){null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}reset(){this.stop(),this.carImage&&(this.carImage.style.left=`${this.initialPosition}px`)}}class k extends s.S{constructor(t,e,n,s,i,r,o){super({tag:"div",classNames:["car__item"]}),this.buttonSelect=null,this.buttonRemove=null,this.buttonStart=null,this.buttonStop=null,this.carImage=null,this.carInstance=t,this.formUpdate=e,this.garageController=n,this.garageView=s,this.animation=new _,this.updateTitleAndCarList=i,this.removeCallback=r,this.selectCallback=o,this.setupCarItem()}renderCarImageAndButtonStartStop(){this.buttonStart=new C(this.garageController,this.garageView,this.animation),this.buttonStart.getElement().dataset.id=`${this.carInstance.id}`,this.buttonStop=new v(this.garageController,this.garageView,this.animation),this.buttonStop.getElement().dataset.id=`${this.carInstance.id}`;const{color:t}=this.carInstance;this.carImage=new w(t);const e=(new f).getElement();e.append(this.buttonStart.getElement(),this.buttonStop.getElement(),this.carImage.getElement()),this.addInnerElement(e)}renderControlPanel(){const{id:t}=this.carInstance;this.buttonSelect=new E(this.selectCallback,this.formUpdate,t),this.buttonRemove=new p(this.updateTitleAndCarList,this.removeCallback,t,this.garageController);const{name:e}=this.carInstance,n=new b(e).getElement(),s=(new f).getElement();s.append(this.buttonSelect.getElement(),this.buttonRemove.getElement(),n),this.addInnerElement(s)}setupCarItem(){const{id:t}=this.carInstance;this.getElement().id=`${t}`;const{raceController:e}=this.garageController;e.addCustomAnimation(this,this.animation),this.renderControlPanel(),this.renderCarImageAndButtonStartStop()}}class L extends s.S{constructor(){super({tag:"div",classNames:["car__list"]})}}class A extends s.S{constructor(t,e){super({tag:"button",classNames:["next__btn"]}),this.controller=t,this.garageView=e,this.onClickNext=this.onClickNext.bind(this),this.setupButton(),this.setupEventListener()}setupEventListener(){this.getElement().addEventListener("click",this.onClickNext)}onClickNext(){return t=this,e=void 0,s=function*(){const{raceController:t}=this.controller;t.clearCustomAnimation();try{yield this.controller.nextPage(),this.garageView.updateTitleAndCarList()}catch(t){t instanceof Error&&console.error(t.message)}},new((n=void 0)||(n=Promise))((function(i,r){function o(t){try{l(s.next(t))}catch(t){r(t)}}function a(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}));var t,e,n,s}setupButton(){this.getElement().textContent="next"}}class I extends s.S{constructor(t,e){super({tag:"button",classNames:["prev__bnt"]}),this.controller=t,this.garageView=e,this.onClickPrev=this.onClickPrev.bind(this),this.setupButton(),this.setupEventListener()}setupEventListener(){this.getElement().addEventListener("click",this.onClickPrev)}onClickPrev(){return t=this,e=void 0,s=function*(){const{raceController:t}=this.controller;t.clearCustomAnimation();try{yield this.controller.prevPage(),this.garageView.updateTitleAndCarList()}catch(t){t instanceof Error&&console.error(t.message)}},new((n=void 0)||(n=Promise))((function(i,r){function o(t){try{l(s.next(t))}catch(t){r(t)}}function a(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}));var t,e,n,s}setupButton(){this.getElement().textContent="prev"}}class P extends s.S{constructor(t,e){super({tag:"section",classNames:["pagination"]}),this.controller=t,this.garageView=e,this.setupPagination()}setupPagination(){const t=new I(this.controller,this.garageView),e=new A(this.controller,this.garageView);this.getElement().append(t.getElement(),e.getElement())}}class T extends s.S{constructor(t){super({tag:"section",classNames:["garage"]}),this.controlPanel=null,this.title=null,this.subTitle=null,this.controller=t;const{raceController:e}=this.controller;e.clearCustomAnimation(),this.carList=new L,this.formUpdate=new d(this.controller,this),this.render()}render(){return t=this,e=void 0,s=function*(){try{yield this.controller.loadCars(),this.renderFormAdd(),this.renderFormUpdate(),this.renderControlPanel(),this.renderTitle(),this.renderSubTitle(),this.renderCarList(),this.renderCarItem(),this.renderPagination()}catch(t){t instanceof Error&&console.error(t.message)}},new((n=void 0)||(n=Promise))((function(i,r){function o(t){try{l(s.next(t))}catch(t){r(t)}}function a(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((s=s.apply(t,e||[])).next())}));var t,e,n,s}updateTitleAndCarList(){if(this.controlPanel){const{resetButton:t,raceButton:e}=this.controlPanel;(null==t?void 0:t.getElement()).disabled=!0,(null==e?void 0:e.getElement()).disabled=!1}if(this.title){const{totalCarsCount:t}=this.controller.getPageAndTotalCount(),e=this.title.getElement().querySelector("span");e&&(e.textContent=`(${t})`)}if(this.subTitle){const{page:t}=this.controller.getPageAndTotalCount(),e=this.subTitle.getElement().querySelector("span");e&&(e.textContent=`# ${t}`)}if(this.carList){for(;this.carList.getElement().firstChild;){const t=this.carList.getElement().firstChild;t&&this.carList.getElement().removeChild(t)}this.renderCarItem()}}renderFormAdd(){const t=this.controller.addCar.bind(this.controller),e=this.updateTitleAndCarList.bind(this),n=new h(t,e,this.controller);this.addInnerElement(n.getElement())}renderFormUpdate(){this.addInnerElement(this.formUpdate.getElement())}renderControlPanel(){this.controlPanel=new a(this.controller,this),this.addInnerElement(this.controlPanel.getElement())}renderTitle(){const{totalCarsCount:t}=this.controller.getPageAndTotalCount();this.title=new g(t),this.addInnerElement(this.title.getElement())}renderSubTitle(){const{page:t}=this.controller.getPageAndTotalCount();this.subTitle=new m(t),this.addInnerElement(this.subTitle.getElement())}renderCarList(){this.addInnerElement(this.carList.getElement())}renderCarItem(){const t=this.controller.removeCar.bind(this.controller),e=this.controller.getCar.bind(this.controller),n=this.updateTitleAndCarList.bind(this),s=[];this.controller.getCars().forEach((i=>{s.push(new k(i,this.formUpdate,this.controller,this,n,t,e).getElement())})),this.carList.getElement().append(...s)}renderPagination(){const t=new P(this.controller,this);this.addInnerElement(t.getElement())}}}}]);